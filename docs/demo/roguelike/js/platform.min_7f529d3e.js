var __reflect=this&&this.__reflect||function(e,t,n){e.__class__=t,n?n.push(t):n=[t],e.__types__=e.__types__?n.concat(e.__types__):n},__extends=this&&this.__extends||function(e,t){function n(){this.constructor=e}for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o]);n.prototype=t.prototype,e.prototype=new n},__decorate=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,a=3>i?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(3>i?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},__awaiter=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))(function(r,i){function a(e){try{l(o.next(e))}catch(t){i(t)}}function s(e){try{l(o["throw"](e))}catch(t){i(t)}}function l(e){e.done?r(e.value):new n(function(t){t(e.value)}).then(a,s)}l((o=o.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function n(e){return function(t){return o([e,t])}}function o(n){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,i&&(a=i[2&n[0]?"return":n[0]?"throw":"next"])&&!(a=a.call(i,n[1])).done)return a;switch(i=0,a&&(n=[0,a.value]),n[0]){case 0:case 1:a=n;break;case 4:return l.label++,{value:n[1],done:!1};case 5:l.label++,i=n[1],n=[0];continue;case 7:n=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){l=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){l.label=n[1];break}if(6===n[0]&&l.label<a[1]){l.label=a[1],a=n;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(n);break}a[2]&&l.ops.pop(),l.trys.pop();continue}n=t.call(e,l)}catch(o){n=[6,o],i=0}finally{r=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,i,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},platform;!function(e){var t=function(e){function t(){var t=e.call(this)||this;return t.create(),t}return __extends(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return this.$name},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ads",{get:function(){return this.$ads},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rankDialog",{get:function(){return this.$rankDialog},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isAvailable",{get:function(){return!0},enumerable:!0,configurable:!0}),t.prototype.create=function(){},t.prototype.notifyState=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n]},t.prototype.login=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.resolve(!1)},t.prototype.getWorldRank=function(){return Promise.resolve(null)},t.prototype.getFriendRank=function(){return Promise.resolve(null)},t.prototype.get=function(e){return Promise.resolve(null)},t.prototype.set=function(e,t){return Promise.resolve(null)},t}(egret.EventDispatcher);e.PBase=t,__reflect(t.prototype,"platform.PBase",["platform.IPlatform","vitamin.IStorage"])}(platform||(platform={}));var platform;!function(e){var t;!function(e){e[e.INSET_PAGE=0]="INSET_PAGE",e[e.VIDEO_INSPIRE=1]="VIDEO_INSPIRE"}(t=e.TypeAdsVideo||(e.TypeAdsVideo={}));var n=function(){function e(){}return e.INSET_PAGE_LOAD_ERR="INSET_PAGE_LOAD_ERR",e.INSET_PAGE_LOADED="INSET_PAGE_LOADED",e.VIDEO_INSPIRE_LOAD_ERR="VIDEO_INSPIRE_LOAD_ERR",e.VIDEO_INSPIRE_LOADED="VIDEO_INSPIRE_LOADED",e}();e.AdsEvent=n,__reflect(n.prototype,"platform.AdsEvent");var o=function(e){function t(){var t=e.call(this)||this;return t.inspiredMaxCount=3,t._inspiredCount=t.inspiredMaxCount,t}return __extends(t,e),t.prototype.initialize=function(e){return this.$options=e,this.inspiredMaxCount=void 0!=e.inspiredMaxCount?e.inspiredMaxCount:3,Promise.resolve()},t.prototype.showBanner=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]},t.prototype.hideBanner=function(){},Object.defineProperty(t.prototype,"videoLoaded",{get:function(){return this._videoLoaded},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"videoLoading",{get:function(){return this._videoLoading},enumerable:!0,configurable:!0}),t.prototype.preloadVideo=function(e){},t.prototype.showVideo=function(e,t){},t.prototype.onVideoClose=function(e,t){},Object.defineProperty(t.prototype,"inspiredCount",{get:function(){return this._inspiredCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isInspired",{get:function(){return this._inspiredCount>0},enumerable:!0,configurable:!0}),t.prototype.resetInspired=function(){this._inspiredCount=this.inspiredMaxCount},t.prototype.checkInspired=function(){return this._inspiredCount--,this._inspiredCount<=0?(this.resetInspired(),!0):!1},t}(egret.EventDispatcher);e.ADSBase=o,__reflect(o.prototype,"platform.ADSBase")}(platform||(platform={}));var platform;!function(e){function t(t){return function(n){e.__platforms[t]=n}}function n(t){return function(n){e.__ads[t]=n}}var o;!function(e){e.Debug="debug",e.FACEBOOK="facebook",e.GOOGLE="google",e.WXGAME="wxgame",e.BYTEDANCE="bytedance"}(o=e.TypePlatform||(e.TypePlatform={}));var r;!function(e){e[e.Loading=0]="Loading",e[e.Loaded=1]="Loaded"}(r=e.TypePlatState||(e.TypePlatState={}));var i=function(){function e(){}return e.USERINFO_LOADED="USERINFO_LOADED",e.REC_STATE_CHANGE="REC_STATE_CHANGE",e}();e.PlatformEvent=i,__reflect(i.prototype,"platform.PlatformEvent");var a=function(){function e(){}return e.NONE=0,e.RECORDING=1,e.RECORDED=2,e}();e.StateRecord=a,__reflect(a.prototype,"platform.StateRecord"),e.WordRankTestData={list:[{rank:1,uid:"1",name:"狸哩亽喵",score:3545531,headurl:"resource/test/1.jpg"},{rank:2,uid:"2",name:"啃骨头的喵呜",score:3508732,headurl:"resource/test/2.jpg"},{rank:3,uid:"3",name:"蘑菇头女孩",score:2835571,headurl:"resource/test/3.jpg"},{rank:4,uid:"4",name:"梦幻の蝴蝶",score:1534512,headurl:"resource/test/4.jpg"},{rank:5,uid:"5",name:"樱野猫少女",score:1234534,headurl:"resource/test/5.jpg"},{rank:6,uid:"6",name:"ω糖果罐子",score:834341,headurl:"resource/test/6.jpg"},{rank:7,uid:"7",name:"萌妹妹哟",score:754621,headurl:"resource/test/7.jpg"},{rank:8,uid:"8",name:"夢中ら情人",score:695444,headurl:"resource/test/8.jpg"},{rank:9,uid:"9",name:"无暇阿萌",score:565888,headurl:"resource/test/9.jpg"},{rank:10,uid:"10",name:"神经质萌妞",score:559888,headurl:"resource/test/10.jpg"}],mine:{rank:4,uid:"4",name:"丢了兔兔",score:5045,headurl:"resource/test/1.jpg"}},e.FriendRankTestData={list:[{rank:1,uid:"1",name:"桃子果冻ゝ",score:653541,headurl:"resource/test/1.jpg"},{rank:2,uid:"2",name:"好姑涼光芒萬丈",score:607407,headurl:"resource/test/2.jpg"},{rank:3,uid:"3",name:"猫一样的小女人",score:536211,headurl:"resource/test/3.jpg"},{rank:4,uid:"4",name:"look°有灰机",score:356511,headurl:"resource/test/4.jpg"},{rank:5,uid:"5",name:"崽崽酱   ",score:262121,headurl:"resource/test/5.jpg"},{rank:6,uid:"6",name:"风铃鹿",score:223240,headurl:"resource/test/6.jpg"},{rank:7,uid:"7",name:"元気少女",score:197847,headurl:"resource/test/7.jpg"},{rank:8,uid:"8",name:"薰薰",score:135676,headurl:"resource/test/8.jpg"},{rank:9,uid:"9",name:"蓝鲸少女与猫",score:12374,headurl:"resource/test/9.jpg"},{rank:10,uid:"10",name:"森林迷了鹿",score:9972,headurl:"resource/test/10.jpg"}],mine:{rank:4,uid:"4",name:"丢了兔兔",score:5045,headurl:"resource/test/1.jpg"}},e.__platforms={},e.__ads={},e.Platform=t,e.Ads=n}(platform||(platform={}));var platform;!function(e){var t=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.initialize=function(){return Promise.resolve()},n.prototype.getUserData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.resolve(null)},n.prototype.setRankScore=function(e,t,n,o){return Promise.resolve()},n.prototype.share=function(){return Promise.resolve()},n.prototype.createDisplayObject=function(t,n,o,r,i){window.sharedCanvas.width=r,window.sharedCanvas.height=i,window.sharedCanvas.x=n,window.sharedCanvas.y=o;var a=new egret.BitmapData(window.sharedCanvas);a.$deleteSource=!1;var s=new egret.Texture;s._setBitmapData(a);var l=new egret.Bitmap(s);if(l.width=r,l.height=i,l.x=n,l.y=o,"webgl"==egret.Capabilities.renderMode){var c;switch(this.$name){case e.TypePlatform.WXGAME:c=egret.wxgame.WebGLRenderContext.getInstance();break;case e.TypePlatform.BYTEDANCE:c=egret.ttgame.WebGLRenderContext.getInstance()}var u=c.context;u.wxBindCanvasTexture||egret.startTick(function(e){return egret.WebGLUtils.deleteWebGLTexture(a.webGLTexture),a.webGLTexture=null,!1},this)}return this.postMessage("initialize",{x:n,y:o,width:vitamin.stage.width,height:vitamin.stage.height,canvasWidth:r,canvasHeight:i}),l},n.prototype.postMessage=function(t,n){n.command=t;var o;switch(this.$name){case e.TypePlatform.WXGAME:o=window.wx.getOpenDataContext();break;case e.TypePlatform.BYTEDANCE:o=window.tt.getOpenDataContext()}o.postMessage(n)},n}(e.PBase);e.PMini=t,__reflect(t.prototype,"platform.PMini")}(platform||(platform={}));var platform;!function(e){var t=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.initialize=function(e){return __awaiter(this,void 0,void 0,function(){var n,o=this;return __generator(this,function(r){switch(r.label){case 0:return this.isAvailable?[4,t.prototype.initialize.call(this,e)]:[2,Promise.resolve()];case 1:return r.sent(),n=tt.getSystemInfoSync(),this.$options.bannerId&&(this._banner=tt.createBannerAd({adUnitId:this.$options.bannerId,adIntervals:15,style:{left:.1*n.screenWidth,top:.8*n.screenHeight,width:.8*n.screenWidth}}),this._banner.onLoad(function(){o._bannerLoaded=!0}),this._banner.onError(function(){o._bannerError=!0}),this._banner.onResize(function(e){console.log(e.width,e.height),o._banner.style.top=.8*n.screenHeight,o._banner.style.left=(n.screenWidth-e.width)/2})),this._video=tt.createRewardedVideoAd({adUnitId:this.$options.videoId}),[2,Promise.resolve()]}})})},n.prototype.showBanner=function(e,t){var n=this;void 0===e&&(e=.1),void 0===t&&(t=.2),.16>t&&(t=.16),!this._bannerError&&this._banner&&(this._bannerLoaded?this._banner.show():this._banner.onLoad(function(){n._bannerLoaded=!0;var o=tt.getSystemInfoSync();n._banner.style.left=o.screenWidth*e,n._banner.style.top=o.screenHeight*(1-t),n._banner.style.width=o.screenWidth*(1-2*e),n._banner.show()}))},n.prototype.hideBanner=function(){this._banner&&this._banner.hide()},n.prototype.preloadVideo=function(t){try{this._videoLoading=!1,this._videoLoaded=!0,this.dispatchEventWith(t==e.TypeAdsVideo.INSET_PAGE?e.AdsEvent.INSET_PAGE_LOADED:e.AdsEvent.VIDEO_INSPIRE_LOADED)}catch(n){console.error(n)}},n.prototype.showVideo=function(e){this.showVideoHandler(3,e.caller,e.sucess,e.fail)},n.prototype.showVideoHandler=function(e,t,n,o){var r=this;this._video.show().then(function(){console.log("广告显示成功"),r.onVideoClose(t,n),r._videoCloseHandler=r.videoCloseHandler.bind(r),r._video.onClose(r._videoCloseHandler)})["catch"](function(i){console.log("广告组件出现问题",i),e--,0>=e?(console.log("广告显示失败",i),r._videoLoaded=!1,o&&o()):r.showVideoHandler(e,t,n,o)})},n.prototype.videoCloseHandler=function(e){console.log("广告播放完成"),this._video.offClose(this._videoCloseHandler),this._videoCloseHandler=null,this._videoLoaded=!1,this._videoCompletes.runWith(e.isEnded)},n.prototype.onVideoClose=function(e,t){this._video&&(this._videoCompletes||(this._videoCompletes=new vitamin.Handlers(!0)),this._videoCompletes.add(e,t))},Object.defineProperty(n.prototype,"isAvailable",{get:function(){return!!window.tt},enumerable:!0,configurable:!0}),n=__decorate([e.Ads(e.TypePlatform.BYTEDANCE)],n)}(e.ADSBase);e.AdBytedance=t,__reflect(t.prototype,"platform.AdBytedance")}(platform||(platform={}));var platform;!function(e){var t=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e._recordState=0,e}return __extends(n,t),n.prototype.initialize=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.isAvailable?(this.postMessage("loadAssets",{}),[2,Promise.resolve()]):[2,Promise.resolve()]})})},n.prototype.parseRankData=function(e){for(var t=[],n=1,o=0,r=e;o<r.length;o++){for(var i,a=r[o],s=0,l=a.KVDataList;s<l.length;s++){var c=l[s];"floor"==c.key&&(i=JSON.parse(c.value))}t.push({rank:n++,uid:a.openid,name:a.nickname,score:i?i.ttgame.floor:-1,head:a.avatarUrl})}return t},n.prototype.getWorldRank=function(){var e=this;return new Promise(function(t){e.getRankData(0,e,function(n){t(e.parseRankData(n))})})},n.prototype.getFriendRank=function(){var e=this;return new Promise(function(t){e.getRankData(1,e,function(n){t(e.parseRankData(n))})})},n.prototype.getRankData=function(e,t,n){wx.getCloudStorageByRelation({type:0==e?"group":"friend",keyList:["floor"],extra:{sortKey:"floor",groupId:"world"},success:function(e){console.log(e),n.call(t,e.data)},fail:function(e){wx.showToast({title:"获取排行榜失败!"}),console.log("获取数据失败")}})},n.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return this._isLogin?[2,Promise.resolve(!0)]:[4,this.checkSessionHandler()];case 1:return e=t.sent(),e?[3,3]:[4,this.loginHandler()];case 2:t.sent(),t.label=3;case 3:return[2,Promise.resolve(!0)]}})})},n.prototype.getUserData=function(t){var n=this;return this.userInfo?Promise.resolve(this.userInfoSimple):new Promise(function(o,r){n.login().then(function(){n._userButton||(n._userButton=wx.createUserInfoButton({type:"text",text:"点击登录",style:{left:t.x,top:t.y,width:t.width,height:t.height,lineHeight:50,backgroundColor:"#20C263",color:"#ffffff",textAlign:"center",fontSize:18,borderRadius:16},withCredentials:!1})),n._userButtonTapHandler=function(){wx.getUserInfo({success:function(t){n.userInfo=t.userInfo,n.userInfoSimple={uid:"",name:n.userInfo.nickName,headurl:n.userInfo.avatarUrl},console.log("用户信息获取成功:",t.userInfo),o(n.userInfoSimple),n.dispatchEventWith(e.PlatformEvent.USERINFO_LOADED,!1,n.userInfoSimple)}})},n._userButton.show(),n._userButton.onTap(n._userButtonTapHandler)})})},n.prototype.cancelGetUserInfo=function(){this._userButton&&(this._userButton.offTap(this._userButtonTapHandler),this._userButton.hide())},n.prototype.userButtonTapHandler=function(){},n.prototype.checkSessionHandler=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,t){wx.checkSession({success:function(t){console.log("session未过期"),e(!0)},fail:function(t){console.log("session已过期"),e(!1)}})})]})})},n.prototype.loginHandler=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){wx.login({success:function(n){console.log("登录成功"),e._isLogin=!0,t(!0)},fail:function(e){console.log("登录失败"),t(!1)}})})]})})},Object.defineProperty(n.prototype,"isLogin",{get:function(){return!!this.userInfo},enumerable:!0,configurable:!0}),n.prototype.startRecord=function(e,t){var n=this;this._startRecordTime=egret.getTimer(),this._recordState=1;var o=wx.getGameRecorder();if(!o.isFrameSupported())return void vitamin.ui.tip("当前不支持录制游戏画面.");o.start({duration:30}),o.on("stop",function(o){egret.getTimer()-n._startRecordTime<5e3?(vitamin.ui.tip("录屏时间太短,录制无效!"),n._recordState=0):(n._recordState=2,t&&t.call(e)),n.dispatchEventWith("REC_STATE_CHANGE")}),this.dispatchEventWith("REC_STATE_CHANGE")},n.prototype.stopRecord=function(){var e=wx.getGameRecorder();e.stop(),this.hasRecord()||(this._recordState=0,this.dispatchEventWith("REC_STATE_CHANGE"))},n.prototype.hasRecord=function(){return 2==this._recordState},Object.defineProperty(n.prototype,"recordState",{get:function(){return this._recordState},enumerable:!0,configurable:!0}),n.prototype.createGameRecorderShareButton=function(){var e=wx.createGameRecorderShareButton({style:{left:10,top:150,height:50,color:"#ffffff",textAlign:"center",fontSize:16,borderRadius:4,iconMarginRight:16,paddingLeft:1,paddingRight:30},image:"button.jpg",text:"分享视频",icon:"icon.jpg",share:{query:"a=1&b=2",bgm:"walkin.mp3",timeRange:[[0,1e3],[2e3,3e3]],title:{template:"default.score",data:{score:6500}},button:{template:"default.enter"}}});return this._recordState=0,this.dispatchEventWith("REC_STATE_CHANGE"),e},n.prototype.share=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.isAvailable?(wx.shareAppMessage({title:"切瓜一时爽，一直切瓜一直爽",imageUrl:"resource/icon1.png"}),[2,Promise.resolve()]):[2,Promise.resolve()]})})},n.prototype.setRankScore=function(e,t,n,o){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return this.postMessage("updaterank",{floor:e,score:t}),o&&o.call(n),[2,Promise.resolve()]})})},n=__decorate([e.Platform(e.TypePlatform.WXGAME)],n)}(e.PMini);e.PWXGame=t,__reflect(t.prototype,"platform.PWXGame",["platform.IPlatform","vitamin.IStorage"])}(platform||(platform={}));var platform;!function(e){var t=function(t){function n(){var e=null!==t&&t.apply(this,arguments)||this;return e.SCOPE_USERINFO="scope.userInfo",e._recordState=0,e}return __extends(n,t),n.prototype.initialize=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.isAvailable?(this.postMessage("loadAssets",{}),[2,Promise.resolve()]):[2,Promise.resolve()]})})},n.prototype.parseRankData=function(e){for(var t=[],n=1,o=0,r=e;o<r.length;o++){for(var i,a=r[o],s=0,l=a.KVDataList;s<l.length;s++){var c=l[s];"floor"==c.key&&(i=JSON.parse(c.value))}t.push({rank:n++,uid:a.openid,name:a.nickname,score:i?i.ttgame.floor:-1,head:a.avatarUrl})}return t},n.prototype.getWorldRank=function(){var e=this;return new Promise(function(t){e.getRankData(0,e,function(n){t(e.parseRankData(n))})})},n.prototype.getFriendRank=function(){return __awaiter(this,void 0,void 0,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t){e.getRankData(1,e,function(n){t(e.parseRankData(n))})})]})})},n.prototype.getRankData=function(e,t,n){tt.getCloudStorageByRelation({type:0==e?"group":"friend",keyList:["floor"],extra:{sortKey:"floor",groupId:"world"},success:function(e){console.log(e),n.call(t,e.data)},fail:function(e){tt.showToast({title:"获取排行榜失败!"}),console.log("获取数据失败")}})},n.prototype.login=function(e){return __awaiter(this,void 0,void 0,function(){var t,n;return __generator(this,function(o){switch(o.label){case 0:return[4,this.checkSession()];case 1:return t=o.sent(),t||e?[4,this.loginPlatform()]:[3,3];case 2:return n=o.sent(),[2,Promise.resolve(n)];case 3:return[2,Promise.resolve(!1)]}})})},n.prototype.checkSession=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,t){tt.checkSession({success:function(t){console.log("session未过期"),e(!0)},fail:function(t){console.log("session已过期"),e(!1)}})})]})})},n.prototype.getUserData=function(e,t){return __awaiter(this,void 0,void 0,function(){var n,o=this;return __generator(this,function(r){switch(r.label){case 0:return this.userInfoSimple?(t&&t.call(e,this.userInfoSimple),[2,Promise.resolve(this.userInfoSimple)]):this.isAvailable?this.session?[3,2]:[4,this.login(!0)]:(t.call(e,null),[2,Promise.resolve(null)]);case 1:if(n=r.sent(),!n)return t.call(e,null),[2,Promise.resolve(null)];r.label=2;case 2:return[2,new Promise(function(n,r){return o.userInfoSimple?(t&&t.call(e,o.userInfoSimple),void n(o.userInfoSimple)):void o.getUserInfo(o,function(r){r?(t.call(e,o.userInfoSimple),n(o.userInfoSimple)):(t.call(e,null),n(null))})})]}})})},n.prototype.getUserInfo=function(e,t){var n=this;tt.getSetting({scope:this.SCOPE_USERINFO,success:function(o){console.log("授权设置:",o),tt.showToast({title:"授权设置:"+o.authSetting[n.SCOPE_USERINFO],icon:"none",duration:1e3}),o.authSetting[n.SCOPE_USERINFO]?n.getUserInfoHandler(e,t):void 0==o.authSetting[n.SCOPE_USERINFO]?n.getUserInfoHandler(e,t):tt.openSetting({scope:n.SCOPE_USERINFO,success:function(o){console.log("用户授权设置后:",o),o.authSetting[n.SCOPE_USERINFO]&&n.getUserInfoHandler(e,t)}})}})},n.prototype.getUserInfoHandler=function(t,n){var o=this;tt.authorize({scope:this.SCOPE_USERINFO,success:function(r){console.log("授权成功!"),tt.getUserInfo({success:function(r){o.userInfo=r.userInfo,o.userInfoSimple={uid:o.session.openid,name:o.userInfo.nickName,headurl:o.userInfo.avatarUrl},console.log("用户信息获取成功:",r.userInfo),n&&n.call(t,!0),o.dispatchEventWith(e.PlatformEvent.USERINFO_LOADED,!1,o.userInfoSimple)},fail:function(e){console.error("用户信息获取失败!"),tt.showToast({title:"用户信息获取失败...",icon:"fail",duration:3e3}),n&&n.call(t,!1)}})},fail:function(e){console.error("授权失败!"),tt.showToast({title:"授权失败...",icon:"fail",duration:3e3}),n&&n.call(t,!1)}})},n.prototype.setUserGroup=function(){tt.setUserGroup({groupId:"world_group",success:function(e){console.log("SetGroup Success!")},fail:function(){console.log("SetGroup Fail!")}})},n.prototype.loginPlatform=function(e,t){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(o){return this.session?(t&&t.call(e,!0),[2,Promise.resolve(!0)]):[2,new Promise(function(o,r){tt.login({success:function(r){console.log("login调用成功,code:"+r.code+",anonymousCode:"+r.anonymousCode),tt.request({url:"https://developer.toutiao.com/api/apps/jscode2session",data:{appid:n.$appId,secret:n.$appSecret,code:r.code,anonymous_code:r.anonymousCode},success:function(r){n.session=r.data,console.log("获取登录信息成功!"),n.setUserGroup(),t&&t.call(e,!0),o(!0)},fail:function(n){console.error("从服务器获取登录信息失败!"),t&&t.call(e,!1),o(!1)}})},fail:function(n){console.error("login调用失败:"+JSON.stringify(n)),t&&t.call(e,!1),o(!1)}})})]})})},Object.defineProperty(n.prototype,"isLogin",{get:function(){return!!this.userInfo},enumerable:!0,configurable:!0}),n.prototype.getAccessToken=function(e,t){var n=this;return this._acessToken&&this._acessToken.value&&egret.getTimer()<this._acessToken.invalidTime?void(t&&t.call(e,this._acessToken.value)):void tt.request({url:"ttps://developer.toutiao.com/api/apps/token",data:{appid:this.$appId,secret:this.$appSecret,grant_type:"client_credential"},success:function(o){n._acessToken={value:o.data.access_token,invalidTime:egret.getTimer()+1e3*o.data.expires_in},console.log("获取AccessToken成功!"),t&&t.call(e,n._acessToken.value)},fail:function(n){console.error("获取AccessToken失败!"),t&&t.call(e)}})},n.prototype.uploadData=function(e){return __awaiter(this,void 0,void 0,function(){var t=this;return __generator(this,function(n){return[2,new Promise(function(n,o){t.getAccessToken(t,function(o){if(!o)return console.error("数据上传失败!"),void n(null);var r={kv_list:e},i=CryptoJS.HmacSHA256(JSON.stringify(r),t.session.session_key).toString();tt.request({url:"https://developer.toutiao.com/api/apps/set_user_storage",method:"POST",data:{access_token:o,openid:t.session.openid,signature:i,sig_method:"hmac_sha256",kv_list:r.kv_list},success:function(e){0==e.errcode?console.log("数据上传成功!"):console.error("数据上传失败:",e)},fail:function(e){console.error("数据上传失败:",e)}})})})]})})},n.prototype.startRecord=function(t,n){var o=this;this._hasRecord=!1,this._videoPath="",this._recordState=e.StateRecord.RECORDING;var r=tt.getGameRecorderManager(),i=[];r.start({duration:40}),vitamin.timer.loop(4e3,this,function(){r.recordClip({timeRange:[4,4],success:function(e){console.log(e.index),i.push(e.index),o._hasRecord=!0}})}),r.onStop(function(r){n&&n.call(t),vitamin.timer.clearAll(o),console.log(r.videoPath),o._videoPath=r.videoPath,o._hasRecord?(tt.showToast({title:"视频录制完成!",icon:"success",duration:1e3}),o._recordState=e.StateRecord.RECORDED):(vitamin.ui.tip("录屏时间太短,录制无效!"),o._recordState=e.StateRecord.NONE),o.dispatchEventWith(e.PlatformEvent.REC_STATE_CHANGE)}),this.dispatchEventWith(e.PlatformEvent.REC_STATE_CHANGE)},n.prototype.stopRecord=function(){var t=tt.getGameRecorderManager();t.stop(),vitamin.timer.clearAll(this),this.hasRecord()||(this._recordState=e.StateRecord.NONE,this.dispatchEventWith(e.PlatformEvent.REC_STATE_CHANGE))},n.prototype.hasRecord=function(){return console.log("hasRecord:",this._videoPath,this._hasRecord),this._videoPath&&this._hasRecord},Object.defineProperty(n.prototype,"recordState",{get:function(){return this._recordState},enumerable:!0,configurable:!0}),n.prototype.publishRecord=function(t,n){var o=this,r=tt.getGameRecorderManager();r.clipVideo({path:this._videoPath,success:function(r){console.log(r.videoPath),tt.shareAppMessage({channel:"video",title:"快来围观这波骚操作",desc:"切瓜一时爽，一直切瓜一直爽！",imageUrl:"resource/icon1.png",templateId:"",query:"",extra:{videoPath:r.videoPath,videoTopics:["论一直切瓜有多爽?","今天我又被切瓜爽到了!"]},success:function(){console.log("分享视频成功"),o._hasRecord=!1,o._videoPath="",o._recordState=e.StateRecord.NONE,n&&n.call(t,!0),o.dispatchEventWith(e.PlatformEvent.REC_STATE_CHANGE)},fail:function(r){console.log("分享视频失败"),o._hasRecord=!1,o._videoPath="",o._recordState=e.StateRecord.NONE,n&&n.call(t,!1),o.dispatchEventWith(e.PlatformEvent.REC_STATE_CHANGE)}})},fail:function(r){console.error(r),o._hasRecord=!1,o._videoPath="",o._recordState=e.StateRecord.NONE,n&&n.call(t,!1),o.dispatchEventWith(e.PlatformEvent.REC_STATE_CHANGE)}})},n.prototype.share=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return this.isAvailable?(tt.shareAppMessage({templateId:"7ad5ricmeab14v2hld",success:function(){console.log("分享成功"),tt.showToast({title:"恭喜分享成功!"})},fail:function(e){console.log("分享失败")}}),[2,Promise.resolve()]):[2,Promise.resolve()]})})},n.prototype.setRankScore=function(e,t,n,o){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(r){return this.postMessage("updaterank",{floor:e,score:t}),o&&o.call(n),[2,Promise.resolve()]})})},n=__decorate([e.Platform(e.TypePlatform.BYTEDANCE)],n)}(e.PMini);e.PBytedance=t,__reflect(t.prototype,"platform.PBytedance")}(platform||(platform={}));var platform;!function(e){var t=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),Object.defineProperty(n.prototype,"isAvailable",{get:function(){return!!window.FBInstant},enumerable:!0,configurable:!0}),n.prototype.initialize=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.isAvailable?[4,FBInstant.initializeAsync()]:[2,Promise.resolve()];case 1:return e.sent(),console.log("FB initialize!!"),[2,Promise.resolve()]}})})},n.prototype.notifyState=function(t,n){if(!this.isAvailable)return Promise.resolve();switch(t){case e.TypePlatState.Loading:FBInstant.setLoadingProgress(100*n);break;case e.TypePlatState.Loaded:FBInstant.setLoadingProgress(100),FBInstant.startGameAsync()}},n.prototype.getUserData=function(e,t){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(o){return this.isAvailable?(n={uid:FBInstant.player.getID(),name:FBInstant.player.getName(),headurl:FBInstant.player.getPhoto()},t.call(e,n),[2,Promise.resolve(n)]):[2,Promise.resolve(null)]})})},n.prototype.get=function(e){return FBInstant.player.getDataAsync([e])},n.prototype.set=function(e,t){return FBInstant.player.setDataAsync((n={},n[e]=t,n));var n},n.prototype.getWorldRank=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,o,r,i,a,s,l,c,u;return __generator(this,function(d){switch(d.label){case 0:return e="wrold",[4,FBInstant.getLeaderboardAsync(e)];case 1:return t=d.sent(),t?[4,t.getEntryCountAsync()]:(vitamin.ui.tip("排行榜获取失败:"+e),[2,Promise.resolve(null)]);case 2:return n=d.sent(),[4,t.getEntriesAsync(n,0)["catch"](function(t){vitamin.ui.tip("在应用程序配置中找不到排行榜“"+e+"”")})];case 3:for(o=d.sent(),r=1,i=[],a=0,s=o;a<s.length;a++)l=s[a],i.push({rank:r++,uid:l.getPlayer().getID(),name:l.getPlayer().getName(),score:l.getScore(),headurl:l.getPlayer().getPhoto()});return[4,t.getPlayerEntryAsync()];case 4:return c=d.sent(),c&&(u={rank:r++,uid:c.getPlayer().getID(),name:c.getPlayer().getName(),score:c.getScore(),headurl:c.getPlayer().getPhoto()}),[2,Promise.resolve({list:i,mine:u})]}})})},n.prototype.getFriendRank=function(){return __awaiter(this,void 0,void 0,function(){var e,t,n,o,r,i,a,s,l,c,u,d;return __generator(this,function(p){switch(p.label){case 0:return(e=FBInstant.context.getID())?(t="friend."+e,[4,FBInstant.getLeaderboardAsync(t)]):[3,5];case 1:return n=p.sent(),n?[4,n.getEntryCountAsync()]:(vitamin.ui.tip("排行榜获取失败:"+t),[2,Promise.resolve(null)]);case 2:return o=p.sent(),[4,n.getEntriesAsync(o,0)["catch"](function(e){vitamin.ui.tip("在应用程序配置中找不到排行榜“"+t+"”")})];case 3:for(r=p.sent(),i=1,a=[],s=0,l=r;s<l.length;s++)c=l[s],a.push({rank:i++,uid:c.getPlayer().getID(),name:c.getPlayer().getName(),score:c.getScore(),headurl:c.getPlayer().getPhoto()});return[4,n.getPlayerEntryAsync()];case 4:return u=p.sent(),u&&(d={rank:i++,uid:u.getPlayer().getID(),name:u.getPlayer().getName(),score:u.getScore(),headurl:u.getPlayer().getPhoto()}),[2,Promise.resolve({list:a,mine:d})];case 5:return[2,Promise.resolve(null)]}})})},n.prototype.setRankScore=function(e,t,n,o){return __awaiter(this,void 0,void 0,function(){var t,n,o;return __generator(this,function(r){switch(r.label){case 0:return[4,FBInstant.getLeaderboardAsync("wrold")];case 1:return t=r.sent(),t?[4,t.setScoreAsync(e,"")]:[3,3];case 2:return r.sent(),console.log("排行榜",t.getName(),"Score saved"),[3,4];case 3:console.error("排行榜",t.getName(),"Score save error"),r.label=4;case 4:return(n=FBInstant.context.getID())?(o="friend."+n,[4,FBInstant.getLeaderboardAsync(o)]):[3,8];case 5:return t=r.sent(),t?[4,t.setScoreAsync(e,"")]:[3,7];case 6:return r.sent(),console.log(t.getName(),"Score saved"),[3,8];case 7:console.error(t.getName(),"Score save error"),r.label=8;case 8:return[2]}})})},n.prototype.notifyRankChange=function(){var e=FBInstant.context.getID();if(e){var t="friend."+e;FBInstant.updateAsync({action:"LEADERBOARD",name:t}).then(function(){return console.log("Update Posted")})["catch"](function(e){return console.error(e)})}},n.prototype.loadOver=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.isAvailable?[4,FBInstant.setLoadingProgress(100)]:[2,Promise.resolve()];case 1:return e.sent(),[2,Promise.resolve()]}})})},n.prototype.share=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.isAvailable?(FBInstant.shareAsync({intent:"SHARE",image:e?e.toDataURL("image/png"):null,text:"I can't stop! Too much fruit and too fast knife!"}).then(function(){}),[2,Promise.resolve()]):[2,Promise.resolve()]})})},n.prototype.shareByInvite=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return FBInstant?(FBInstant.shareAsync({intent:"INVITE",image:e?e.toDataURL("image/png"):null,text:"I can't stop! Too much fruit and too fast knife!",data:{uid:FBInstant.player.getID()}}).then(function(){}),[2,Promise.resolve()]):[2,Promise.resolve()]})})},n=__decorate([e.Platform(e.TypePlatform.FACEBOOK)],n)}(e.PBase);e.PFaceBook=t,__reflect(t.prototype,"platform.PFaceBook")}(platform||(platform={}));var platform;!function(e){var t=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.initialize=function(){return Promise.resolve()},n.prototype.getUserData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.resolve(null)},n.prototype.setRankScore=function(e,t,n,o){return Promise.resolve()},n.prototype.share=function(){return Promise.resolve()},n.prototype.getWorldRank=function(){return Promise.resolve(e.WordRankTestData)},n.prototype.getFriendRank=function(){return Promise.resolve(e.FriendRankTestData)},n=__decorate([e.Platform(e.TypePlatform.Debug)],n)}(e.PBase);e.PDebug=t,__reflect(t.prototype,"platform.PDebug")}(platform||(platform={}));var platform;!function(e){var t=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n=__decorate([e.Ads(e.TypePlatform.Debug)],n)
}(e.ADSBase);e.AdDebug=t,__reflect(t.prototype,"platform.AdDebug")}(platform||(platform={}));var platform;!function(e){var t=function(t){function n(){var e=t.call(this)||this;return e._isSupported=!1,e._preloadedRewardedVideo=null,e._preloadedInterstitial=null,e._interstitialRetryCount=0,e._inspireRetryCount=0,e}return __extends(n,t),n.prototype.initialize=function(e){return __awaiter(this,void 0,void 0,function(){var n;return __generator(this,function(o){switch(o.label){case 0:return this.isAvailable?[4,t.prototype.initialize.call(this,e)]:[2,Promise.resolve()];case 1:return o.sent(),n=FBInstant.getSupportedAPIs(),n.indexOf("getInterstitialAdAsync")>=0&&n.indexOf("getRewardedVideoAsync")>=0?this._isSupported=!0:(this._isSupported=!1,vitamin.ui.tip("Ads not supported in this session!",16733525)),[2,Promise.resolve()]}})})},n.prototype.showBanner=function(){},n.prototype.hideBanner=function(){},n.prototype.preloadVideo=function(t,n){var o=this;if(void 0===n&&(n=!1),this._isSupported){if(t==e.TypeAdsVideo.INSET_PAGE){if(this._isInterstitialLoaded)return;if(n){if(this._interstitialRetryCount>6)return;this._interstitialRetryCount++}else this._interstitialRetryCount=0;FBInstant.getInterstitialAdAsync(this.$options.interstitialId).then(function(e){return o._preloadedInterstitial=e,o._preloadedInterstitial.loadAsync()}).then(function(){o._isInterstitialLoaded=!0,o.dispatchEventWith("INTERSTITIAL_LOADED")})["catch"](function(e){o._isInterstitialLoaded=!1,o.dispatchEventWith("INTERSTITIAL_LOAD_ERROR"),vitamin.ui.tip("Interstitial failed to preload: "+e.message,16733525),o.preloadVideo(t,!0)})}if(t==e.TypeAdsVideo.VIDEO_INSPIRE){if(this._isInspirelLoaded)return;if(n){if(this._inspireRetryCount>3)return;this._inspireRetryCount++}else this._inspireRetryCount=0;FBInstant.getRewardedVideoAsync(this.$options.videoId).then(function(e){return o._preloadedRewardedVideo=e,o._preloadedRewardedVideo.loadAsync()}).then(function(){o._isInspirelLoaded=!0,o.dispatchEventWith("INSPIRE_LOADED")})["catch"](function(e){o._isInspirelLoaded=!1,o.dispatchEventWith("INSPIRE_LOAD_ERROR"),vitamin.ui.tip("Rewarded video failed to preload:"+e.message,16733525),o.preloadVideo(t,!0)})}}},n.prototype.showVideo=function(t,n){var o=this;if(!this._isSupported)return void t.fail.call(t.caller);if(n==e.TypeAdsVideo.INSET_PAGE){if(!this._isInterstitialLoaded)return void t.fail.call(t.caller);this._preloadedInterstitial.showAsync().then(function(){o._isInterstitialLoaded=!1,t.sucess.call(t.caller,!0)})["catch"](function(e){o._isInterstitialLoaded=!1,t.fail.call(t.caller)})}if(n==e.TypeAdsVideo.VIDEO_INSPIRE){if(!this._videoLoaded)return void t.fail.call(t.caller);this._videoLoading=!0,this._videoLoaded=!1,this._preloadedRewardedVideo.showAsync().then(function(){o._videoLoaded=!0,o._videoLoading=!1,t.sucess.call(t.caller,!0)})["catch"](function(e){o._videoLoaded=!1,o._videoLoading=!1,t.fail.call(t.caller)})}},n.prototype.onVideoClose=function(e,t){},Object.defineProperty(n.prototype,"isAvailable",{get:function(){return!!window.FBInstant},enumerable:!0,configurable:!0}),n=__decorate([e.Ads(e.TypePlatform.FACEBOOK)],n)}(e.ADSBase);e.AdFacebook=t,__reflect(t.prototype,"platform.AdFacebook")}(platform||(platform={}));var platform;!function(e){var t=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),Object.defineProperty(n.prototype,"isAvailable",{get:function(){return!!window.AdMob},enumerable:!0,configurable:!0}),n.prototype.initialize=function(e){return __awaiter(this,void 0,void 0,function(){var n=this;return __generator(this,function(o){switch(o.label){case 0:return this.isAvailable?[4,t.prototype.initialize.call(this,e)]:(vitamin.ui.tip("AdMob没有定义!"),[2,Promise.resolve()]);case 1:return o.sent(),window.AdMob.getAdSettings(function(e){console.log("adId: "+e.adId+"\nadTrackingEnabled: "+e.adTrackingEnabled)},function(){console.log("failed to get user ad settings")}),window.gameConfig.release||vitamin.ui.tip("Ads Test:"+window.gameConfig.adsTest,11184640),window.AdMob.setOptions({position:window.AdMob.AD_POSITION.BOTTOM_CENTER,isTesting:window.gameConfig.adsTest,bgColor:"black"}),document.addEventListener("onAdFailLoad",function(e){"undefined"!=typeof e.originalEvent&&(e=e.originalEvent);var t=e.detail||e.data||e;alert("error: "+t.error+", reason: "+t.reason+", adNetwork:"+t.adNetwork+", adType:"+t.adType+", adEvent:"+t.adEvent)}),document.addEventListener("onAdLoaded",function(e){"undefined"!=typeof e.originalEvent&&(e=e.originalEvent);var t=e.data||e;"interstitial"===t.adType||"rewardvideo"===t.adType}),document.addEventListener("onBannerReceive",function(e){window.gameConfig.release||vitamin.ui.tip("广告载入成功!",11184640)}),document.addEventListener("onBannerFailedToReceive",function(e){window.gameConfig.release||vitamin.ui.tip("广告载入失败!",43520),n.hideBanner()}),document.addEventListener("onBannerPresent",function(e){vitamin.ui.tip("Banner载入成功!",43520)}),document.addEventListener("onBannerLeaveApp",function(e){vitamin.ui.tip("Banner被点击!",43520)}),document.addEventListener("onBannerDismiss",function(e){vitamin.ui.tip("Banner被关闭!",43520)}),document.addEventListener("onInterstitialReceive",function(e){vitamin.ui.tip("插页已载入!",43520)}),document.addEventListener("onInterstitialFailedToReceive",function(e){vitamin.ui.tip("插页载入失败!",11141120),n.hideBanner()}),document.addEventListener("onInterstitialPresent",function(e){vitamin.ui.tip("插页已准备就绪!",43520)}),document.addEventListener("onInterstitialLeaveApp",function(e){vitamin.ui.tip("插页被触发!",43520)}),document.addEventListener("onInterstitialDismiss",function(e){vitamin.ui.tip("插页被关闭!",43520)}),[2,Promise.resolve()]}})})},n.prototype.showBanner=function(){var e=this;if(this.isAvailable&&!this._bannerShowed){if(this._bannerShowed=!0,this._bannerCreated)return void this.updateBananer();window.gameConfig.release||vitamin.ui.tip("正在创建Banner...!",43520),window.AdMob.createBanner({adId:this.$options.videoId,adSize:"SMART_BANNER",offsetTopBar:!1,overlap:!1,position:window.AdMob.AD_POSITION.BOTTOM_CENTER,autoShow:!0},function(){e._bannerCreated=!0,e.updateBananer()})}},n.prototype.hideBanner=function(){},n.prototype.updateBananer=function(){this._bannerCreated&&window.AdMob&&(this._bannerShowed?window.AdMob.showBanner():window.AdMob.hideBanner())},n.prototype.preloadVideo=function(t){var n=this;this.isAvailable&&(t==e.TypeAdsVideo.INSET_PAGE&&(this._isPreInterstitialLoading=!0,vitamin.ui.tip("开始预加载插页...",43520),window.AdMob.prepareInterstitial({adId:this.$options.interstitialId,autoShow:!1},function(){vitamin.ui.tip("开始预加载插页完成.",43520),n._isInterstitialLoaded=!0,n._isPreInterstitialLoading=!1},function(){vitamin.ui.tip("开始预加载插页失败.",11141120),n._isInterstitialLoaded=!1,n._isPreInterstitialLoading=!1})),t==e.TypeAdsVideo.VIDEO_INSPIRE&&(this._videoLoading=!0,vitamin.ui.tip("开始预加载奖励视频...",43520),window.AdMob.prepareRewardVideoAd({adId:this.$options.videoId,autoShow:!1},function(){vitamin.ui.tip("开始预加载奖励视频完成.",43520),n._videoLoaded=!0,n._videoLoading=!1},function(){vitamin.ui.tip("开始预加载奖励视频失败.",11141120),n._videoLoaded=!1,n._videoLoading=!1})))},n.prototype.showVideo=function(t,n){var o=this;if(this.isAvailable){if(n==e.TypeAdsVideo.INSET_PAGE){if(!this._isInterstitialLoaded)return void vitamin.ui.tip("插页未加载...",11141120);if(vitamin.ui.tip("开始显示插页...",43520),window.AdMob)return void window.AdMob.showInterstitial(function(){o._isInterstitialLoaded=!1,t.sucess.call(t.caller,!0)},t.fail);t.fail.call(t.caller)}if(n==e.TypeAdsVideo.VIDEO_INSPIRE){if(!this._isInspirelLoaded)return void vitamin.ui.tip("奖励视频未加载...",11141120);if(vitamin.ui.tip("开始显示奖励视频...",43520),window.AdMob)return void window.AdMob.showRewardVideoAd(function(){o._isInspirelLoaded=!1,t.sucess.call(t.caller,!0)},t.fail);t.fail.call(t.caller)}}},n.prototype.onVideoClose=function(e,t){},n=__decorate([e.Ads(e.TypePlatform.GOOGLE)],n)}(e.ADSBase);e.AdGoogle=t,__reflect(t.prototype,"platform.AdGoogle")}(platform||(platform={}));var platform;!function(e){var t=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.initialize=function(e){return __awaiter(this,void 0,void 0,function(){var n,o=this;return __generator(this,function(r){switch(r.label){case 0:return this.isAvailable?[4,t.prototype.initialize.call(this,e)]:[2,Promise.resolve()];case 1:return r.sent(),n=tt.getSystemInfoSync(),this.$options.bannerId&&(this._banner=tt.createBannerAd({adUnitId:this.$options.bannerId,adIntervals:15,style:{left:.1*n.screenWidth,top:.8*n.screenHeight,width:.8*n.screenWidth}}),this._banner.onLoad(function(){o._bannerLoaded=!0}),this._banner.onError(function(){o._bannerError=!0}),this._banner.onResize(function(e){console.log(e.width,e.height),o._banner.style.top=.8*n.screenHeight,o._banner.style.left=(n.screenWidth-e.width)/2})),this._video=tt.createRewardedVideoAd({adUnitId:this.$options.videoId}),[2,Promise.resolve()]}})})},n.prototype.showBanner=function(e,t){var n=this;void 0===e&&(e=.1),void 0===t&&(t=.2),.16>t&&(t=.16),!this._bannerError&&this._banner&&(this._bannerLoaded?this._banner.show():this._banner.onLoad(function(){n._bannerLoaded=!0;var o=tt.getSystemInfoSync();n._banner.style.left=o.screenWidth*e,n._banner.style.top=o.screenHeight*(1-t),n._banner.style.width=o.screenWidth*(1-2*e),n._banner.show()}))},n.prototype.hideBanner=function(){this._banner&&this._banner.hide()},n.prototype.preloadVideo=function(t){try{this._videoLoading=!1,this._videoLoaded=!0,this.dispatchEventWith(t==e.TypeAdsVideo.INSET_PAGE?e.AdsEvent.INSET_PAGE_LOADED:e.AdsEvent.VIDEO_INSPIRE_LOADED)}catch(n){console.error(n)}},n.prototype.showVideo=function(e){this.showVideoHandler(3,e.caller,e.sucess,e.fail)},n.prototype.showVideoHandler=function(e,t,n,o){var r=this;this._video.show().then(function(){console.log("广告显示成功"),r.onVideoClose(t,n),r._videoCloseHandler=r.videoCloseHandler.bind(r),r._video.onClose(r._videoCloseHandler)})["catch"](function(i){console.log("广告组件出现问题",i),e--,0>=e?(console.log("广告显示失败",i),r._videoLoaded=!1,o&&o()):r.showVideoHandler(e,t,n,o)})},n.prototype.videoCloseHandler=function(e){console.log("广告播放完成"),this._video.offClose(this._videoCloseHandler),this._videoCloseHandler=null,this._videoLoaded=!1,this._videoCompletes.runWith(e.isEnded)},n.prototype.onVideoClose=function(e,t){this._video&&(this._videoCompletes||(this._videoCompletes=new vitamin.Handlers(!0)),this._videoCompletes.add(e,t))},Object.defineProperty(n.prototype,"isAvailable",{get:function(){return!!window.tt},enumerable:!0,configurable:!0}),n=__decorate([e.Ads(e.TypePlatform.WXGAME)],n)}(e.ADSBase);e.AdWechat=t,__reflect(t.prototype,"platform.AdWechat")}(platform||(platform={}));var platform;!function(e){var t=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.initialize=function(){return Promise.resolve()},n.prototype.getUserData=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Promise.resolve(null)},n.prototype.setRankScore=function(e,t,n,o){return Promise.resolve()},n.prototype.share=function(){return Promise.resolve()},n=__decorate([e.Platform(e.TypePlatform.GOOGLE)],n)}(e.PBase);e.PGoogle=t,__reflect(t.prototype,"platform.PGoogle")}(platform||(platform={}));var platform;!function(e){function t(t){var n=e.__platforms[vitamin.Config.platform];if(n){e.inst=new n,e.inst.$name=vitamin.Config.platform;var o=e.__ads[vitamin.Config.platform],r=void 0;if(o&&(r=e.inst.$ads=new o),t&&t[vitamin.Config.platform]){var i=t[vitamin.Config.platform];for(var a in i)e.inst["$"+a]=i[a];r&&r.initialize(i.ads)}}return e.inst}e.initialize=t}(platform||(platform={}));var platform;!function(e){var t=function(t){function n(e,n){var o=t.call(this,e)||this;return o._button=e,o._type=n,o._videoIcon=new egret.Bitmap(RES.getRes("ui_json.icon_video")),e.addChild(o._videoIcon),o._videoIcon.y=e.height/2-o._videoIcon.height/2,o._videoIcon.x=e.width-o._videoIcon.width-10,o._loadingIcon=new egret.Bitmap(RES.getRes("ui_json.icon_video_loading")),e.addChild(o._loadingIcon),o._loadingIcon.anchorOffsetX=o._loadingIcon.texture.textureWidth/2,o._loadingIcon.anchorOffsetY=o._loadingIcon.texture.textureHeight/2,o._loadingIcon.x=o._videoIcon.x+o._videoIcon.width/2,o._loadingIcon.y=o._videoIcon.y+o._videoIcon.height/2,o}return __extends(n,t),n.prototype.initialize=function(){this._button.enabled=!!e.inst,this.updateState()},n.prototype.addlistener=function(){e.inst&&(e.inst.ads.once("INSPIRE_LOADED",this.updateState,this),e.inst.ads.once("INSPIRE_LOAD_ERROR",this.updateState,this))},n.prototype.removelistener=function(){e.inst&&(e.inst.ads.removeEventListener("INSPIRE_LOADED",this.updateState,this),e.inst.ads.removeEventListener("INSPIRE_LOAD_ERROR",this.updateState,this))},n.prototype.updateState=function(){if(e.inst){if(e.inst.ads.videoLoaded)return this.removelistener(),void this.isLoadOver();if(e.inst.ads.videoLoading)return this.isLoading(),void this.addlistener();vitamin.ui.tip("视频未在加载中....")}this._button.enabled=!1,this.reset()},n.prototype.reset=function(){this.removelistener(),this._videoIcon.visible=!1,this._loadingIcon.visible=!1,vitamin.ticker.remove(this,this.render)},n.prototype.isLoading=function(){this._videoIcon.visible=!0,this._loadingIcon.visible=!0,this._videoIcon.alpha=.4,vitamin.ticker.add(this,this.render)},n.prototype.isLoadOver=function(){this._videoIcon.visible=!0,this._loadingIcon.visible=!1,this._videoIcon.alpha=1,vitamin.ticker.remove(this,this.render)},n.prototype.render=function(){this._loadingIcon.rotation+=2},n}(egret.EventDispatcher);e.AdsButton=t,__reflect(t.prototype,"platform.AdsButton",["platform.IAdsButton"])}(platform||(platform={}));var platform;!function(e){var t=function(e){function t(t){var n=e.call(this,t)||this;return n._button=t,n._icon=new egret.Bitmap(RES.getRes("ui_json.btn_share")),t.addChild(n._icon),n._icon.y=t.height/2-n._icon.height/2,n._icon.x=t.width-n._icon.width-30,n}return __extends(t,e),t.prototype.initialize=function(){},t.prototype.reset=function(){},t}(egret.EventDispatcher);e.ShareButton=t,__reflect(t.prototype,"platform.ShareButton",["platform.IAdsButton"])}(platform||(platform={}));