!function(t){var e={};function i(s){if(e[s])return e[s].exports;var a=e[s]={i:s,l:!1,exports:{}};return t[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)i.d(s,a,function(e){return t[e]}.bind(null,a));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=2)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.D3Sprite=void 0;const s=i(1);class a extends Laya.Sprite3D{constructor(){super(),this._rotaAddtion=new Laya.Vector3,this._cache=new Laya.Vector2,this._position={x:0,y:0,isGlobal:!1},this.transform.localScale.setValue(1.2,1.2,1.2),this.transform.localScale=this.transform.localScale}destroy(t){super.destroy(t),this._position=null,this.d3=null}reset(){this.stopRotaion(),this._position.x=0,this._position.y=0}addChild(t){return super.addChild(t),t instanceof a&&(t.d3=this.d3,t.ticks=this.ticks,t.d3layer=this.d3layer),t}removeChild(t){return super.removeChild(t),t instanceof a&&(t.d3=null,t.ticks=null),t}pos(t,e,i){this._position.x=t,this._position.y=e,this._position.isGlobal=i,this.updatePosition()}set x(t){this._position.x=t,Laya.timer.callLater(this,this.updatePosition)}get x(){return this._position.x}set y(t){this._position.y=t,Laya.timer.callLater(this,this.updatePosition)}get y(){return this._position.y}getAdjust(t){t||(t=new Laya.Vector2),t.setValue(0,0);let e=this.parent;for(;e instanceof a;)t.x+=e.x,t.y+=e.y,e=this.parent.parent;return t}updatePosition(){this.d3&&(this.d3.isReady?this.__$updatePosition():this.d3.once(s.D3Event.READY,this,this.__$updatePosition))}__$updatePosition(){let t=this._position.x,e=this._position.y;if(!this._position.isGlobal){const i=this.d3layer.get2dOffset(t,e);if(!i)return;t=i.x,e=i.y}let i=this._cache=this.getAdjust(this._cache);t+=i.x,e+=i.y,this.__position=this.d3.convertCoord(t,e,null,null,this.__position),this.transform.position.setValue(this.__position.x,this.__position.y,-5),this.transform.position=this.transform.position}setPosition(t,e,i){this.transform.position.setValue(null!=t?t:0,null!=e?e:0,null!=i?i:0),this.transform.position=this.transform.position}setScale(t,e,i){null!=t&&(this.transform.localScale.x=t),null!=e&&(this.transform.localScale.y=e),null!=i&&(this.transform.localScale.z=i),this.transform.localScale=this.transform.localScale}startRotaion(t,e,i){let s=this.getChildAt(0);if(s)return this._originalRotation||(this._originalRotation=s.transform.rotation.clone()),s.transform.rotation.x=this._originalRotation.x,s.transform.rotation.y=this._originalRotation.y,s.transform.rotation.z=this._originalRotation.z,s.transform.rotation.w=this._originalRotation.w,s.transform.rotation=s.transform.rotation,this._rotaAddtion.setValue(t,e,i),this.ticks&&this.ticks.add(this,this.updateFrameHandler),this}stopRotaion(){this.ticks&&this.ticks.remove(this,this.updateFrameHandler);let t=this.getChildAt(0);t&&this._originalRotation&&(t.transform.rotation.x=this._originalRotation.x,t.transform.rotation.y=this._originalRotation.y,t.transform.rotation.z=this._originalRotation.z,t.transform.rotation.w=this._originalRotation.w,t.transform.rotation=t.transform.rotation)}updateFrameHandler(){this.getChildAt(0).transform.rotate(this._rotaAddtion,!1,!1)}rotationOnce(t,e,i){let s=this.getChildAt(0);s&&(Laya.Tween.clearAll(s.transform),this._originalEuler||(this._originalEuler={x:s.transform.localRotationEulerX,y:s.transform.localRotationEulerY,z:s.transform.localRotationEulerZ}),s.transform.localRotationEulerX=this._originalEuler.x,s.transform.localRotationEulerY=this._originalEuler.y,s.transform.localRotationEulerZ=this._originalEuler.z,Laya.Tween.to(s.transform,{localRotationEulerX:this._originalEuler.x+(null!=t?t:0),localRotationEulerY:this._originalEuler.y+(null!=e?e:0),localRotationEulerZ:this._originalEuler.z+(null!=i?i:0)},1e3,Laya.Ease.circInOut,Laya.Handler.create(this,()=>{s.transform.localRotationEulerX=s.transform.localRotationEulerX%360,s.transform.localRotationEulerY=s.transform.localRotationEulerY%360,s.transform.localRotationEulerZ=s.transform.localRotationEulerZ%360})))}}e.D3Sprite=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.D3Event=void 0;class s{}e.D3Event=s,s.READY="ready"},function(t,e,i){t.exports=i(3)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(4);new class{constructor(){window.Laya3D?Laya3D.init(s.default.width,s.default.height):Laya.init(s.default.width,s.default.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=s.default.scaleMode,Laya.stage.screenMode=s.default.screenMode,Laya.stage.alignV=s.default.alignV,Laya.stage.alignH=s.default.alignH,Laya.URL.exportSceneToJson=s.default.exportSceneToJson,(s.default.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),s.default.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),s.default.stat&&Laya.Stat.show(),Laya.alertGlobalError=!0,Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){s.default.startScene&&Laya.Scene.open(s.default.startScene)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5);class a{constructor(){}static init(){(0,Laya.ClassUtils.regClass)("script/GameUI.ts",s.default)}}e.default=a,a.width=1136,a.height=640,a.scaleMode="fixedwidth",a.screenMode="none",a.alignV="top",a.alignH="left",a.startScene="test/TestScene.scene",a.sceneRoot="",a.debug=!1,a.stat=!1,a.physicsDebug=!1,a.exportSceneToJson=!0,a.init()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),a=i(0),o=i(7),r=i(11);class l extends r.ui.test.TestSceneUI{constructor(){super(),Laya.stage.bgColor="#361c1c",this.list=this.getChildByName("list"),this.list.x=Laya.stage.width/2-this.list.width/2,this.list.y=Laya.stage.height/2-this.list.height/2;for(var t=[],e=0;e<20;e++)t.push({m_label:"No."+e});this.list.array=t;let i=o.D3View.get("ui");i.getLayer("panel1").initialize({aglinComp:this.list,scroll:{y:!0}}),i.enableLayer("panel1");let s=231,a=8;for(let e=0;e<t.length;e++){let t=this.createCube(.8);i.addToLayer("panel1",t),t.pos(s+40,a+40+94*e),t.startRotaion(1,1,1)}Laya.stage.on(Laya.Event.RESIZE,this,()=>{o.D3View.get("ui").update(),console.log(this)})}onOpened(t){o.D3View.get("ui").update()}onClosed(t){o.D3View.get("ui").disableLayer()}createCube(t=1){let e=new a.D3Sprite,i=new s.D3Cube(.5);return i.setScale(t,t,t),e.addChild(i),e}addTestCube(){let t=o.D3View.get("ui"),e=this.createCube();t.addToLayer("panel1",e);let i=new Laya.Sprite;Laya.stage.addChild(i),i.alpha=.5,i.graphics.drawCircle(0,0,5,"#ffff00"),Laya.stage.on(Laya.Event.MOUSE_DOWN,this,()=>{i.pos(Laya.stage.mouseX,Laya.stage.mouseY),e.pos(Laya.stage.mouseX-t.d3vp.viewRect.x,Laya.stage.mouseY-t.d3vp.viewRect.y,!0),e.rotationOnce(0,360,0)})}}e.default=l},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.D3Cube=void 0;class s extends Laya.MeshSprite3D{constructor(t=1,e){super(Laya.PrimitiveMesh.createBox(t,t,t));var i=this.material=new Laya.PBRSpecularMaterial;i.albedoColor=e||new Laya.Vector4(Math.random(),Math.random(),Math.random(),1),i.smoothness=.8,this.meshRenderer.material=i,this._rotaAddtion=new Laya.Vector3}destroy(t){super.destroy(t),this.material.destroy()}startRotaion(t,e,i){return this._rotaAddtion.setValue(t,e,i),Laya.timer.frameLoop(1,this,this.updateFrameHandler),this}stopRotaion(){Laya.timer.clear(this,this.updateFrameHandler)}updateFrameHandler(){this.transform.rotate(this._rotaAddtion,!1,!1)}setPosition(t,e,i){this.transform.position.setValue(null!=t?t:0,null!=e?e:0,null!=i?i:0)}setScale(t,e,i){null!=t&&(this.transform.localScale.x=t),null!=e&&(this.transform.localScale.y=e),null!=i&&(this.transform.localScale.z=i),this.transform.localScale=this.transform.localScale}setPosition2d(t,e,i){let s=new Laya.Vector3;s.setValue(e,i,0),t.convertScreenCoordToOrthographicCoord(s,s),s.z=this.transform.position.z,this.transform.position=s}}e.D3Cube=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.D3View=void 0;const s=i(1),a=i(8),o=i(10);class r extends Laya.EventDispatcher{constructor(t){super(),this._d3vp=new o.D3ViewPort,this._d3vp.initialize(t),this._layers=[]}static get(t){return r.__map||(r.__map={}),r.__map[t]||(r.__map[t]=new r(t))}createLayer(t="default"){let e=new a.D3Layer(this);return e.name=t,e.d3=this,this._layers.push(e),e}enableLayer(t){for(let e of this._layers)e.name!=t&&e.remove();this._curLayer=this.addLayer(t),this.update()}disableLayer(t){if(t)this._curLayer==this.removeLayer(t)&&(this._curLayer=null);else{for(let t of this._layers)t.remove();this._curLayer=null}}getLayer(t){for(let e of this._layers)if(e.name==t)return e;return this.createLayer(t)}addLayer(t){let e=this.getLayer(t);return e.add(),e}removeLayer(t){let e=this.getLayer(t);return e.remove(),e}destroy(t){for(let t in this._layers)this._layers[t].destroy(),this._layers[t]=null,delete this._layers[t];this._d3vp.destroy(t)}clear(){for(let t in this._layers)this._layers[t].clear()}update(){if(!this._curLayer)return;let t=this._curLayer.aglinComp,e=t.localToGlobal(new Laya.Point),i=this._curLayer.get2dScaleOffset();i&&(this.d3vp.update(e.x,e.y,t.width*i.scaleX,t.height*i.scaleY),this._curLayer.update(t.x,t.y,t.width,t.height),this._curLayer.updateScrollPosition(),this.event(s.D3Event.READY))}convertCoord(t,e,i,s,a){if(i||(i=this._d3vp.viewRect),s||(s=this._d3vp.camera),a||(a=new Laya.Vector3),!i)return console.warn("坐标转换错误,未设置视口大小..."),a;let o=t*(Laya.stage.width/i.width),r=e*(Laya.stage.height/i.height);return a.setValue(o,r,0),s.convertScreenCoordToOrthographicCoord(a,a),a}setVisible(t){for(let e of this._layers)e.visible=t;this.d3vp.scene3d.visible=t}get name(){return this._d3vp.camera.name}get d3vp(){return this._d3vp}get viewWidth(){return this._curLayer?this._curLayer.width:0}get viewHeight(){return this._curLayer?this._curLayer.height:0}get isReady(){return!!this._d3vp.viewRect}addChild(t){this._d3vp.scene3d.addChild(t),t.d3=this}removeChild(t){this._d3vp.scene3d.removeChild(t),t.d3=null}addToLayer(t,e){this.getLayer(t).addChild(e),e.d3=this}removeFromLayer(t,e){this.getLayer(t).removeChild(e),e.d3=null}addToLayerTop(t,e){this.getLayer(t).addChildToTop(e)}removeFromLayerTop(t,e){this.getLayer(t).removeChildFromTop(e)}addToLayerBottom(t,e){this.getLayer(t).addChildToBottom(e)}removeFromLayerBottom(t,e){this.getLayer(t).removeChildFromBottom(e)}}e.D3View=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.D3Layer=void 0;const s=i(0),a=i(9);class o extends s.D3Sprite{constructor(t){super(),this.d3=t,this.top=new Laya.Sprite,this.top.mouseEnabled=!1,this.bottom=new Laya.Sprite,this.bottom.mouseEnabled=!1,this.ticks=new a.Ticks,this.d3layer=this}initialize(t){var e,i;return this._aglinComp=t.aglinComp,this.bindScroll(null===(e=t.scroll)||void 0===e?void 0:e.y,null===(i=t.scroll)||void 0===i?void 0:i.x),this}get deafultParent(){return this._aglinComp instanceof Laya.Sprite?this._aglinComp.parent:this._aglinComp.parent.displayListContainer}get aglinComp(){return this._aglinComp instanceof Laya.Sprite?this._aglinComp:this._aglinComp.displayObject}add(){!this.isOnView&&this._aglinComp&&(this.deafultParent.addChild(this.bottom),this.d3.d3vp.addTo(this.deafultParent),this.d3.d3vp.scene3d.addChild(this),this.deafultParent.addChild(this.top),this.ticks.enable=!0)}remove(){this.isOnView&&(this.d3.d3vp.remove(),this.removeSelf(),this.top.removeSelf(),this.bottom.removeSelf(),this.ticks.enable=!1)}get isOnView(){return!!this.top.parent}clear(){this.d3.d3vp.clear(),this.top.removeChildren(),this.bottom.removeChildren()}destroy(t){this.remove(),this.ticks.clear(),super.destroy(t),this.top&&(this.top.destroy(t),this.top=null),this.bottom&&(this.bottom.destroy(t),this.bottom=null)}update(t,e,i,a){this.top.pos(t,e),this.bottom.pos(t,e),this.setScrollRect(this.top,0,0,i,a),this.setScrollRect(this.bottom,0,0,i,a),this.updatePosition();for(let t=0;t<this.numChildren;t++){let e=this.getChildAt(t);e instanceof s.D3Sprite&&e.updatePosition()}}bindScroll(t=!1,e=!1){if(this._aglinComp&&(t||e)){if(this._aglinComp instanceof Laya.Sprite){this._aglinComp instanceof Laya.List?this.scrollContainer=this._aglinComp.getChildAt(0):this.scrollContainer=this._aglinComp;let i=this;if(e){let t=this.scrollContainer.scrollRect.x;Object.defineProperty(this.scrollContainer.scrollRect,"x",{set:function(t){this._x=t,i.__updateScrollPosition()},get:function(){return this._x}}),this.scrollContainer.scrollRect.x=t}if(t){let t=this.scrollContainer.scrollRect.y;Object.defineProperty(this.scrollContainer.scrollRect,"y",{set:function(t){this._y=t,i.__updateScrollPosition()},get:function(){return this._y}}),this.scrollContainer.scrollRect.y=t}}else this.scrollContainer=this._aglinComp.scrollPane._container,e&&a.proxyGetterSetter(this.scrollContainer,"x",{caller:this,set:t=>{this.__updateScrollPosition()}}),t&&a.proxyGetterSetter(this.scrollContainer,"y",{caller:this,set:t=>{this.__updateScrollPosition()}});return this.updateScrollPosition(),this}}unBindScroll(){if(this.scrollContainer){if(this._aglinComp instanceof Laya.Sprite){let t=this._aglinComp.scrollRect.x,e=this._aglinComp.scrollRect.y;Object.defineProperty(this.scrollContainer.scrollRect,"x",{value:t}),Object.defineProperty(this.scrollContainer.scrollRect,"y",{value:e})}else a.unProxyGetterSetter(this.scrollContainer,"x"),a.unProxyGetterSetter(this.scrollContainer,"y");this.scrollContainer=null}}updateScrollPosition(){this._aglinComp&&this.d3.isReady&&this.__updateScrollPosition()}__updateScrollPosition(){let t=this.scrollContainer.localToGlobal(new Laya.Point);if(this.isOnView)if(this._aglinComp instanceof Laya.Sprite){if(!this.scrollContainer.scrollRect)return;this.updateScrollHandler(this.scrollContainer.scrollRect.x,this.scrollContainer.scrollRect.y,t.x-this.d3.d3vp.viewRect.x,t.y-this.d3.d3vp.viewRect.y)}else this.updateScrollHandler(-this.scrollContainer.x,-this.scrollContainer.y,t.x-this.d3.d3vp.viewRect.x,t.y-this.d3.d3vp.viewRect.y)}updateScrollHandler(t,e,i,s){this.top.scrollRect.x=t,this.top.scrollRect.y=e,this.bottom.scrollRect.x=t,this.bottom.scrollRect.y=e,this.pos(i,s,!0)}setScrollRect(t,e,i,s,a){let o=t.scrollRect;o||(o=new Laya.Rectangle),o.setTo(e,i,s,a),t.scrollRect=o}get2dOffset(t,e){let i=this.get2dScaleOffset();return i?{x:t*i.scaleX,y:e*i.scaleY}:null}get2dScaleOffset(){let t=1,e=1,i=this.aglinComp;for(;i!=Laya.stage;){if(!i)return null;t*=i.scaleX,e*=i.scaleY,i=i.parent}return{scaleX:t,scaleY:e}}addChildToTop(t){this.top.addChild(t)}removeChildFromTop(t){this.top.removeChild(t)}addChildToBottom(t){this.bottom.addChild(t)}removeChildFromBottom(t){this.bottom.removeChild(t)}set visible(t){this.top.visible=this.bottom.visible=this.active=t}get visible(){return this.top.visible}get width(){return this.aglinComp.width}get height(){return this.aglinComp.height}}e.D3Layer=o},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unProxyGetterSetter=e.proxyGetterSetter=e.getGetter=e.getSetter=e.Ticks=void 0;function s(t,e){return Object.getPrototypeOf(t).__lookupSetter__(e)}function a(t,e){return Object.getPrototypeOf(t).__lookupGetter__(e)}e.Ticks=class{constructor(){this._ticks=[],this._enable=!0}clear(){this._ticks.forEach(t=>t.recover()),this._ticks.length=0}set enable(t){this._enable!=t&&(this._enable=t,this._enable?this._ticks.length>0&&Laya.timer.frameLoop(1,this,this.tickHandler):Laya.timer.clear(this,this.tickHandler))}get enable(){return this._enable}add(t,e,...i){this._ticks||(this._ticks=[]),this._ticks.push(Laya.Handler.create(t,e,i,!1)),this._enable&&Laya.timer.frameLoop(1,this,this.tickHandler)}remove(t,e){for(let i=0;i<this._ticks.length;i++){let s=this._ticks[i];if(s.caller==t&&s.method==e){s.recover(),this._ticks.splice(i,1);break}}0==this._ticks.length&&Laya.timer.clear(this,this.tickHandler)}tickHandler(){for(let t of this._ticks)t.run()}},e.getSetter=s,e.getGetter=a,e.proxyGetterSetter=function(t,e,i){let o=s(t,e),r=a(t,e),l=Object.getPrototypeOf(t);l[`__orig_${e}_Setter__`]=o,l[`__orig_${e}_Getter__`]=r,Object.defineProperty(t,e,{set:function(t){i.setpre&&(t=i.setpre.call(i.caller,t)),o.call(this,t),i.set&&i.set.call(i.caller,this[e])},get:function(){let t=r.call(this);return i.get?i.get.call(i.caller,t):t},enumerable:!0,configurable:!0})},e.unProxyGetterSetter=function(t,e){let i=Object.getPrototypeOf(t),s=i[`__orig_${e}_Setter__`],a=i[`__orig_${e}_Getter__`];s&&a&&Object.defineProperty(t,e,{set:s,get:a,enumerable:!0,configurable:!0})}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.D3ViewPort=void 0;e.D3ViewPort=class{initialize(t){this.create(),this.light.intensity=1.5,this.camera.name=t,this.camera.useOcclusionCulling=!0,this.camera.orthographic=!0,this.camera.clearFlag=Laya.Camera.CLEARFLAG_DEPTHONLY,this.camera.clearColor=new Laya.Vector4(0,0,0,.1),this.camera.orthographicVerticalSize=7}destroy(t){this.remove(),this.scene3d&&(this.scene3d.destroy(t),this.scene3d=null)}create(){this.scene3d=new Laya.Scene3D,this.light=new Laya.DirectionLight,this.scene3d.addChild(this.light),this.camera=new Laya.Camera(0,.3,100),this.scene3d.addChild(this.camera)}update(t,e,i,s){this.viewRect||(this.viewRect=new Laya.Rectangle),this.viewRect.setTo(t,e,i,s);let a=this.camera.viewport;a.x=t*Laya.stage.clientScaleX,a.y=e*Laya.stage.clientScaleY,a.width=i*Laya.stage.clientScaleX,a.height=s*Laya.stage.clientScaleY,this.camera.viewport=a}set visible(t){this.scene3d.visible=t}get visible(){return this.scene3d.visible}get isReady(){return!!this.viewRect}addTo(t){this.parent=t,this.parent.addChild(this.scene3d)}remove(){this.scene3d.removeSelf()}clear(){this.scene3d.removeChildren()}addChild(t){this.scene3d.addChild(t)}removeChild(t){this.scene3d.removeChild(t)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ui=void 0;var s=Laya.Scene,a=Laya.ClassUtils.regClass;!function(t){!function(t){class e extends s{constructor(){super()}createChildren(){super.createChildren(),this.loadScene("test/TestScene")}}t.TestSceneUI=e,a("ui.test.TestSceneUI",e)}(t.test||(t.test={}))}(e.ui||(e.ui={}))}]);
//# sourceMappingURL=bundle.js.map