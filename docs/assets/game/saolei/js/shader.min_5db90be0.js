var __reflect=this&&this.__reflect||function(e,t,r){e.__class__=t,r?r.push(t):r=[t],e.__types__=e.__types__?r.concat(e.__types__):r},__extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);r.prototype=t.prototype,e.prototype=new r},__awaiter=this&&this.__awaiter||function(e,t,r,i){return new(r||(r=Promise))(function(n,a){function o(e){try{u(i.next(e))}catch(t){a(t)}}function s(e){try{u(i["throw"](e))}catch(t){a(t)}}function u(e){e.done?n(e.value):new r(function(t){t(e.value)}).then(o,s)}u((i=i.apply(e,t||[])).next())})},__generator=this&&this.__generator||function(e,t){function r(e){return function(t){return i([e,t])}}function i(r){if(n)throw new TypeError("Generator is already executing.");for(;u;)try{if(n=1,a&&(o=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(o=o.call(a,r[1])).done)return o;switch(a=0,o&&(r=[0,o.value]),r[0]){case 0:case 1:o=r;break;case 4:return u.label++,{value:r[1],done:!1};case 5:u.label++,a=r[1],r=[0];continue;case 7:r=u.ops.pop(),u.trys.pop();continue;default:if(o=u.trys,!(o=o.length>0&&o[o.length-1])&&(6===r[0]||2===r[0])){u=0;continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){u.label=r[1];break}if(6===r[0]&&u.label<o[1]){u.label=o[1],o=r;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(r);break}o[2]&&u.ops.pop(),u.trys.pop();continue}r=t.call(e,u)}catch(i){r=[6,i],a=0}finally{n=o=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,a,o,s,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},vitamin;!function(e){var t=function(e){function t(t){var r=e.call(this)||this;return t&&r.setShader(t),r}return __extends(t,e),t.prototype.setShader=function(e){e.prototype?this.shader=new e:this.shader=e,this.shader.addTo(this),this.shader.onLoad(this,this.onLoaded)},Object.defineProperty(t.prototype,"shaderLoaded",{get:function(){return this.shader.loaded},enumerable:!0,configurable:!0}),t.prototype.onLoaded=function(){this._loadedHandler&&(this._loadedHandler.method&&this._loadedHandler.method.call(this._loadedHandler.caller),this._loadedHandler.reslove&&this._loadedHandler.reslove())},t.prototype.waitLoaded=function(e,t){var r=this;return new Promise(function(i){r._loadedHandler={caller:e,method:t,reslove:i}})},t.prototype.drawTexture=function(e,t,r,i){var n=i?i:new egret.RenderTexture,a=new egret.Rectangle(0,0,e.width,e.height);return void 0!=t&&(a.width=t,a.x-=t/2-e.width/2),void 0!=r&&(a.height=r,a.y-=r/2-e.height/2),n.drawToTexture(e,a),n},t.prototype.draw=function(e){this.texture=this.drawTexture(e,void 0,void 0,this.texture)},t.prototype.tweenUniform=function(e,t){if(!this.shader)return Promise.resolve();for(var r,i=0,n=t;i<n.length;i++){var a=n[i];r=this.shader.tween(a.uniprop,a.value,e,a.ease)}return r},t.prototype.setTexture=function(e,t,r){return void 0!=t||void 0!=r?(void 0==t&&(t=e.textureWidth),void 0==r&&(r=e.textureHeight),void(this.texture=this.drawTexture(new egret.Bitmap(e),t,r))):void(this.texture=e)},t.prototype.destory=function(){this.shader&&(this.shader.remove(),this.shader=null),this.texture=null,this.parent&&this.parent.removeChild(this)},t}(e.Bitmap);e.ShaderBitmap=t,__reflect(t.prototype,"vitamin.ShaderBitmap")}(vitamin||(vitamin={}));var vitamin;!function(e){e.shaderDebug=!1;var t=function(t){function r(r){var i=t.call(this)||this;return i.$uniforms=r?r:{},i.$padding=0,i.type="custom",i.content=e.ShaderLib["default"],i}return __extends(r,t),Object.defineProperty(r.prototype,"loaded",{get:function(){return this._loaded},enumerable:!0,configurable:!0}),r.prototype.onLoad=function(t,r){this.offLoad(),this.loadHandler=e.Handler.create(t,r,null,!0)},r.prototype.offLoad=function(){this.loadHandler&&(this.loadHandler.recover(),this.loadHandler=null)},r.prototype.callLoaded=function(){this._loaded=!0,this.loadHandler&&(this.loadHandler.runWith(this),this.loadHandler=null)},Object.defineProperty(r.prototype,"content",{get:function(){return this._content},set:function(e){this._content!=e&&(this._content=e,this.$vertexSrc=this._content.vertSrc,this.$fragmentSrc=this._content.fragSrc,this.$shaderKey=this._content.key)},enumerable:!0,configurable:!0}),r.prototype.once=function(){return Promise.resolve()},r.prototype.loop=function(){this.once().then(this.loop.bind(this))},r.prototype.addTo=function(e){if(this.$display!=e){this.$display=e;var t=this.$display.filters?this.$display.filters:[];-1==t.indexOf(this)&&(t.push(this),this.$display.filters=t),this.onDisplayChange(e)}return this},r.prototype.onDisplayChange=function(e){},r.prototype.remove=function(){if(this.tweenStop(),this.$display){if(this.$display.filters){var e=this.$display.filters,t=e.indexOf(this);t>=0&&e.splice(t,1),this.$display.filters=e}this.$display=null}},r.prototype["default"]=function(){this.content=e.ShaderLib["default"]},r.prototype.update=function(t,r,i){r||(r=e.ShaderLib["default"].vertSrc),r=this.getVertSrc(r),t=this.getFragSrc(t);var n=e.ShaderLib.getContent(t,r);n||(n=e.ShaderLib.createContent(r,t,""+this.name+e.getGID())),this.content=n,Object.assign(this.$uniforms,i?i:{}),e.shaderDebug&&(this.$display?e.logShader("attach by "+egret.getQualifiedClassName(this.$display),this.content.vertSrc,this.content.fragSrc):e.logShader(egret.getQualifiedClassName(this),this.content.vertSrc,this.content.fragSrc))},r.prototype.getVertSrc=function(e){return e},r.prototype.getFragSrc=function(e){return e},r.prototype.setUniform=function(e,t){for(var r=e.split("."),i=this.$uniforms;r.length>1;){var n=r.shift();i[n]||(i[n]={}),i=i[n]}i[r.shift()]=t},r.prototype.getUniform=function(e){return this.$uniforms[e]},r.prototype.setSampler=function(e,t,r,i){void 0===i&&(i=!0),t.smooting=r,t.repeat=i,this.setUniform(e,t)},r.prototype.getSampler=function(e){return this.getUniform(e)},r.prototype.tween=function(e,t,r,i){var n=this;return void 0===i&&(i=null),new Promise(function(a){var o=e.split("."),s=n._tweenBody=o.length>1?n.$uniforms[o.shift()]:n.$uniforms,u=o.shift();egret.Tween.get(s).to((c={},c[u]=t,c),r,i).call(a);var c})},r.prototype.tweenStop=function(){this._tweenBody&&(egret.Tween.removeTweens(this._tweenBody),this._tweenBody=null)},Object.defineProperty(r.prototype,"padding",{get:function(){return this.$padding},set:function(e){var t=this;t.$padding!=e&&(t.$padding=e,t.onPropertyChange())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"uniforms",{get:function(){return this.$uniforms},enumerable:!0,configurable:!0}),r.prototype.onPropertyChange=function(){if(egret.nativeRender){var e=this;egret_native.NativeDisplayObject.setFilterPadding(e.$id,e.$padding,e.$padding,e.$padding,e.$padding),egret_native.NativeDisplayObject.setDataToFilter(e)}},r}(egret.Filter);e.ShaderBase=t,__reflect(t.prototype,"vitamin.ShaderBase")}(vitamin||(vitamin={}));var vitamin;!function(e){var t=function(){function e(e,t,r){this._vertSrc=e,this._fragSrc=t,this._key=r}return Object.defineProperty(e.prototype,"vertSrc",{get:function(){return this._vertSrc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fragSrc",{get:function(){return this._fragSrc},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),e}();e.ShaderContent=t,__reflect(t.prototype,"vitamin.ShaderContent")}(vitamin||(vitamin={}));var vitamin;!function(e){function t(e){var t=r.indexOf(e);return-1==t?(r.push(e),r.length):t+1}var r=[],i=egret.wxgame?egret.wxgame:egret.web,n=egret.etc_alpha_mask;i.WebGLRenderContext.prototype.drawData=function(e,r){if(e){var a,o=this.context,s=e.filter;switch(e.type){case 0:if(s)if("custom"===s.type){var u=1;for(var c in s.$uniforms){var h=s.$uniforms[c];if(h instanceof egret.Texture&&!h.__sampler){var f=h.__sampler={gltex:null,position:t(h),smooting:void 0!=h.smooting?h.smooting:!1,repeat:void 0!=h.repeat?h.repeat:!0},l=!1;h.bitmapData.webGLTexture?f.gltex=h.bitmapData.webGLTexture:h.bitmapData.source.texture instanceof WebGLTexture?f.gltex=h.bitmapData.source.texture:(f.gltex=o.createTexture(),l=!0),o.activeTexture(o["TEXTURE"+f.position]),o.bindTexture(o.TEXTURE_2D,f.gltex),l&&o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,h.bitmapData.source),f.smooting?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR)):(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST)),f.repeat?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.REPEAT),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.REPEAT)):(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE)),u++}}a=i.EgretWebGLProgram.getProgram(o,s.$vertexSrc,s.$fragmentSrc,s.$shaderKey)}else"colorTransform"===s.type?e.texture[n]?(o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,e.texture[n]),a=i.EgretWebGLProgram.getProgram(o,i.EgretShaderLib.default_vert,i.EgretShaderLib.colorTransform_frag_etc_alphamask_frag,"colorTransform_frag_etc_alphamask_frag")):a=i.EgretWebGLProgram.getProgram(o,i.EgretShaderLib.default_vert,i.EgretShaderLib.colorTransform_frag,"colorTransform"):"blurX"===s.type?a=i.EgretWebGLProgram.getProgram(o,i.EgretShaderLib.default_vert,i.EgretShaderLib.blur_frag,"blur"):"blurY"===s.type?a=i.EgretWebGLProgram.getProgram(o,i.EgretShaderLib.default_vert,i.EgretShaderLib.blur_frag,"blur"):"glow"===s.type&&(a=i.EgretWebGLProgram.getProgram(o,i.EgretShaderLib.default_vert,i.EgretShaderLib.glow_frag,"glow"));else e.texture[n]?(a=i.EgretWebGLProgram.getProgram(o,i.EgretShaderLib.default_vert,i.EgretShaderLib.texture_etc_alphamask_frag,n),o.activeTexture(o.TEXTURE1),o.bindTexture(o.TEXTURE_2D,e.texture[n])):a=i.EgretWebGLProgram.getProgram(o,i.EgretShaderLib.default_vert,i.EgretShaderLib.texture_frag,"texture");this.activeProgram(o,a),this.syncUniforms(a,s,e.textureWidth,e.textureHeight),r+=this.drawTextureElements(e,r);break;case 1:a=i.EgretWebGLProgram.getProgram(o,i.EgretShaderLib.default_vert,i.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(o,a),this.syncUniforms(a,s,e.textureWidth,e.textureHeight),r+=this.drawRectElements(e,r);break;case 2:a=i.EgretWebGLProgram.getProgram(o,i.EgretShaderLib.default_vert,i.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(o,a),this.syncUniforms(a,s,e.textureWidth,e.textureHeight),r+=this.drawPushMaskElements(e,r);break;case 3:a=i.EgretWebGLProgram.getProgram(o,i.EgretShaderLib.default_vert,i.EgretShaderLib.primitive_frag,"primitive"),this.activeProgram(o,a),this.syncUniforms(a,s,e.textureWidth,e.textureHeight),r+=this.drawPopMaskElements(e,r);break;case 4:this.setBlendMode(e.value);break;case 5:e.buffer.rootRenderTarget.resize(e.width,e.height),this.onResize(e.width,e.height);break;case 6:if(this.activatedBuffer){var d=this.activatedBuffer.rootRenderTarget;(0!=d.width||0!=d.height)&&d.clear(!0)}break;case 7:this.activateBuffer(e.buffer,e.width,e.height);break;case 8:var p=this.activatedBuffer;p&&(p.rootRenderTarget&&p.rootRenderTarget.enabledStencil(),p.enableScissor(e.x,e.y,e.width,e.height));break;case 9:p=this.activatedBuffer,p&&p.disableScissor();break;case 10:o.bindTexture(o.TEXTURE_2D,e.texture),e.smoothing?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.LINEAR)):(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,o.NEAREST),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,o.NEAREST))}return r}},i.WebGLRenderContext.prototype.syncUniforms=function(e,t,r,i){var n=e.uniforms;t&&"custom"===t.type;for(var a in n)if("projectionVector"===a)n[a].setValue({x:this.projectionX,y:this.projectionY});else if("uTextureSize"===a)n[a].setValue({x:r,y:i});else if("uSampler"===a)n[a].setValue(0);else if("uSamplerAlphaMask"===a)n[a].setValue(1);else{var o=t.$uniforms[a];void 0!==o&&(o instanceof egret.Texture?n[a].setValue(o.__sampler.position):n[a].setValue(o))}}}(vitamin||(vitamin={}));var vitamin;!function(e){function t(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return t.length>1?(console.groupCollapsed("[Shader <"+e+"> ]"),t.forEach(function(e){console.log(e.split("\n").map(function(e,t){return t+1+" : "+e}).join("\n"))}),void console.groupEnd()):void console.log(t[0].split("\n").map(function(e,t){return t+1+" : "+e}).join("\n"))}e.logShader=t}(vitamin||(vitamin={}));var vitamin;!function(e){var t=function(t){function r(){var r=t.call(this,new e.Shader("\n    precision mediump float;\n    varying vec2 vTextureCoord;\n    varying vec4 vColor;\n    varying vec4 vPosition;\n    uniform vec2 projectionVector;\n    uniform vec2 uTextureSize;\n    uniform sampler2D uSampler;\n    \n    uniform vec2 scale;\n    uniform vec2 offset;\n    uniform float brightness;\n    void main(){\n        vec4 color;\n        float x=fract(vTextureCoord.x*scale.x+offset.x);\n        float y=fract(vTextureCoord.y*scale.y+offset.y);\n        color=texture2D(uSampler, vec2(x,y));\n        color.rgb*=brightness;\n        gl_FragColor = color;\n    }",{uniforms:{scale:{x:1,y:1},offset:{x:1,y:1},brightness:1}}))||this;return r._textureScale=1,r._offsetX=0,r._offsetY=0,r}return __extends(r,t),Object.defineProperty(r.prototype,"textureScale",{get:function(){return this._textureScale},set:function(e){this._textureScale!=e&&(this._textureScale=e,this.updateScaleX(),this.updateScaleY())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"texture",{get:function(){return this._texture},set:function(t){this._texture!=t&&(this._texture&&this._texture.dispose(),this._texture=t,this._texture&&(this._texture=e.getIndependTexture(this._texture),egret.superSetter(r,this,"texture",this._texture)))},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"offsetX",{get:function(){return this._offsetX},set:function(e){this._offsetX=e;var t=this._offsetX/this.width;this.shader.uniforms.offset.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"offsetY",{get:function(){return this._offsetY},set:function(e){this._offsetY=e;var t=this._offsetY/this.height;this.shader.uniforms.offset.y=t},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"brightness",{get:function(){return this.shader.uniforms.brightness},set:function(e){this.shader.uniforms.brightness=e},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"width",{get:function(){return egret.superGetter(r,this,"width")},set:function(e){egret.superSetter(r,this,"width",e),this.updateScaleX()},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return egret.superGetter(r,this,"height")},set:function(e){egret.superSetter(r,this,"height",e),this.updateScaleY()},enumerable:!0,configurable:!0}),r.prototype.updateScaleX=function(){this.shader.uniforms.scale.x=this.width/this.texture.textureWidth/this._textureScale},r.prototype.updateScaleY=function(){this.shader.uniforms.scale.y=this.height/this.texture.textureHeight/this._textureScale},r}(e.ShaderBitmap);e.TileBitmap=t,__reflect(t.prototype,"vitamin.TileBitmap")}(vitamin||(vitamin={}));var vitamin;!function(e){var t=function(t){function r(r,i){var n=t.call(this,i?i.uniforms:null)||this;return n.name=egret.getQualifiedClassName(n)+"$"+e.uuid(),n.options=i,e.ShaderLib.getFragSrcSync(r).then(function(e){n.onLoaded(e),n.callLoaded()}),n}return __extends(r,t),r.prototype.onLoaded=function(e){this.update(e)},r.prototype.remove=function(){t.prototype.remove.call(this),this.offLoad()},r}(e.ShaderBase);e.Shader=t,__reflect(t.prototype,"vitamin.Shader")}(vitamin||(vitamin={}));var vitamin;!function(e){var t=function(e){function t(t,r,i){var n=e.call(this,i)||this;return n.setSize(t,r),n}return __extends(t,e),t.prototype.setSize=function(e,t){this._quad||(this._quad=new egret.Shape),this._quad.graphics.clear(),this._quad.graphics.beginFill(0,1),this._quad.graphics.drawRect(0,0,e,t),this._quad.graphics.endFill(),this.draw(this._quad)},t}(e.ShaderBitmap);e.Canvas=t,__reflect(t.prototype,"vitamin.Canvas")}(vitamin||(vitamin={}));var vitamin;!function(e){e.__default_vertex_src__="\nattribute vec2 aVertexPosition;    \nattribute vec2 aTextureCoord;\nattribute vec2 aColor;\nuniform vec2 projectionVector;\nconst vec2 center = vec2(-1.0, 1.0);\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec4 vPosition;\nvoid main(){\n    vPosition=vec4((aVertexPosition/projectionVector).xy,1.0,1.0);\n    gl_Position=vec4((aVertexPosition/projectionVector) + center,0.0,1.0);\n    vTextureCoord = aTextureCoord;\n    vColor = vec4(aColor.x,aColor.x,aColor.x,aColor.x);\n}",e.__default_texture_frag_src__="\n{precision}\n    \nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec4 vPosition;\nuniform sampler2D uSampler;\nuniform vec2 projectionVector;\nuniform vec2 uTextureSize;\nuniform float iTime;\nuniform float iTimeDelta;\nuniform float iFrame;\nuniform float mouseX;\nuniform float mouseY;\n\n#define iChannel0 uSampler\n#define fragCoord vTextureCoord\n#define iResolution vec2(1.0,1.0)\n#define iMouse vec3(mouseX,mouseY,0.0)\n\n{content}\n\n{mainentry}\n",e.__default_shape_frag_src__="precision lowp float;\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying vec4 vPosition;\nuniform vec2 projectionVector;\nuniform vec2 uTextureSize;\nuniform float iTime;\nuniform float iTimeDelta;\nuniform float iFrame;\nuniform float mouseX;\nuniform float mouseY;\n#define fragCoord=vTextureCoord\n#define iResolution vec2(1.0,1.0)\n#define iMouse vec3(mouseX,mouseY,0.0)\n{content}\n\n{mainentry}\n"}(vitamin||(vitamin={}));var vitamin;!function(e){var t=function(){function t(){}return t.getContent=function(e,t){for(var r=this._map.$list,i=0;i<r.length;i++){var n=r[i];if(n.fragSrc==e&&n.vertSrc==t)return n}return null},t.getContentByKey=function(e){return this._map.get(e)},t.createContent=function(t,r,i){if(!this._map.has(i)){var n=new e.ShaderContent(t,r,i);return this._map.set(i,n),n}return null},t.cacheContent=function(e){this._map.has(e.key)||this._map.set(e.key,e)},t.getFragSrcSync=function(t,r){return e.ShaderUtil.isSrc(t)?Promise.resolve(t):this.load(t,r)},t.getFragSrc=function(t,r){return e.ShaderUtil.isSrc(t)?t:e.ShaderLoader.get(t)},t.load=function(t,r){return new Promise(function(i){e.ShaderLoader.load(t,r).then(function(e){return e?void i(e):(console.error("加载着色片段错误:",t),void i(null))})})},t["default"]=new e.ShaderContent(e.Sys.egretAdapterLib.EgretShaderLib.default_vert,e.Sys.egretAdapterLib.EgretShaderLib.texture_frag,"texture"),t._map=new e.Hashtable,t}();e.ShaderLib=t,__reflect(t.prototype,"vitamin.ShaderLib")}(vitamin||(vitamin={}));var vitamin;!function(e){var t=function(){function t(){}return t.get=function(e){return this.cache.has(e)?this.cache.get(e):null},t.load=function(t,r){return __awaiter(this,void 0,void 0,function(){var i,n;return __generator(this,function(a){switch(a.label){case 0:return i=t,this.cache.has(i)?[2,this.cache.get(i)]:(t||(t+=".frag"),n=null,void 0!=r?[3,2]:[4,this.loadShader(e.Path.resolve(this.DEFAULT_PATH,t.replace(this.DEFAULT_PATH,"")))]);case 1:return n=a.sent(),[3,6];case 2:return"pixi"!=r?[3,4]:[4,this.loadPixiShader(e.Path.resolve(this.PIXI_PATH,t.replace(this.PIXI_PATH,"")))];case 3:return n=a.sent(),[3,6];case 4:return[4,this.loadToyShader(e.Path.resolve(this.TOY_PATH,t.replace(this.TOY_PATH,"")))];case 5:n=a.sent(),a.label=6;case 6:return this.cache.set(i,n),[2,n]}})})},t.loadShader=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.__loadText(e)];case 1:return[2,t.sent()]}})})},t.loadPixiShader=function(t){return __awaiter(this,void 0,void 0,function(){var r,i,n,a,o,s,u,c;return __generator(this,function(h){switch(h.label){case 0:return this.uniformsConfig?[3,2]:(r=this,[4,this.__loadText(this.PIXI_PATH.replace("pixi/","pixi.uniforms.json"))]);case 1:r.uniformsConfig=h.sent(),i=new RegExp("{screenWidth}","g"),n=new RegExp("{screenHeight}","g"),this.uniformsConfig=this.uniformsConfig.replace(i,egret.lifecycle.stage.stageWidth+"").replace(n,egret.lifecycle.stage.stageHeight+""),this.uniformsConfig=JSON.parse(this.uniformsConfig),h.label=2;case 2:return[4,this.__loadText(""+t)];case 3:a=h.sent(),o=a.split("\n"),s=0,h.label=4;case 4:return s<o.length?(u=o[s].match(/(\$\{).*(\})/g)[0].replace("${","").replace("}",""),u?[4,this.loadPixiShader(""+t.replace(e.Path.basename(t),u+".frag"))]:[3,6]):[3,7];case 5:c=h.sent(),o[s]=c.content,h.label=6;case 6:return s++,[3,4];case 7:return[2,{content:o.join("\n"),uniforms:this.uniformsConfig[e.Path.basename(t).replace(".frag","")]}]}})})},t.loadToyShader=function(e){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.__loadText(e)];case 1:return[2,t.sent()]}})})},t.__loadText=function(t){var r=this;return new Promise(function(i){e.Sys.isMiniGame&&(t=t.replace(".frag",".txt")),RES.getResByUrl(t,i,r,RES.ResourceItem.TYPE_TEXT)})},t.DEFAULT_PATH="resource/filters/",t.PIXI_PATH="resource/filters/pixi/",t.TOY_PATH="resource/filters/shadertoy/",t.cache=new Map,t}();e.ShaderLoader=t,__reflect(t.prototype,"vitamin.ShaderLoader")}(vitamin||(vitamin={}));var vitamin;!function(e){var t=function(t){function r(r,i){var n=t.call(this,i?i.uniforms:null)||this;return n.name=egret.getQualifiedClassName(n),n.options=i,e.ShaderLib.getFragSrcSync(r,"pixi").then(function(e){if(n.onLoaded(e.content),!i.uniforms&&e.uniforms){for(var t in e.uniforms)"{sampler2D}"==e.uniforms[t]&&(e.uniforms[t]=null);Object.assign(n.$uniforms,e.uniforms)}n.callLoaded()}),n}return __extends(r,t),r.prototype.onLoaded=function(e){var t=r.fragment(e);this.update(t)},r.fragment=function(t){var r=e.__default_texture_frag_src__.split("\n").filter(function(e){return e.indexOf("uniform")>=0||e.indexOf("varying")>=0}),i=t.split("\n"),n=i.find(function(e){return e.indexOf("precision mediump float;")>=0||e.indexOf("precision highp float;")>=0});return i=i.map(function(e){return e.replace(/\r/g,"")}),i=i.filter(function(e){return-1==r.indexOf(e)}),n?i=i.filter(function(e){return e!=n}):n="precision mediump float;",e.__default_texture_frag_src__.replace("{precision}",n).replace("{content}",i.join("\n")).replace("{mainentry}\n","")},r}(e.ShaderBase);e.ShaderPixi=t,__reflect(t.prototype,"vitamin.ShaderPixi")}(vitamin||(vitamin={}));var vitamin;!function(e){var t=function(t){function r(r,i){var n=t.call(this,i?i.uniforms:null)||this;return n.name=egret.getQualifiedClassName(n),n.options=i?i:{},e.ShaderLib.getFragSrcSync(r,"shadertoy").then(function(e){n.onLoaded(e,n.options.shape),n.callLoaded()}),n}return __extends(r,t),r.create=function(e,t,i){var n=new r(t,Object.assign(i,{shape:e instanceof egret.Shape}));return n.addTo(e)},r.prototype.remove=function(){egret.lifecycle.stage.removeEventListener(egret.Event.ENTER_FRAME,this.updateRenderer,this),t.prototype.remove.call(this)},r.prototype.onLoaded=function(e,t){var r=this.fragment(e,t);this.update(r),this.iMouse=new egret.Point,this.iTime=this.uniforms.iTime=egret.getTimer()/1e3,this.iTimeDelta=this.uniforms.iFrame=0,this.iFrame=this.uniforms.iTimeDelta=0,egret.lifecycle.stage.addEventListener(egret.Event.ENTER_FRAME,this.updateRenderer,this)},r.prototype.updateRenderer=function(){var e=egret.getTimer()/1e3;this.iTimeDelta=e-this.iTime,this.iTime=e,this.uniforms.iTime=this.iTime,this.uniforms.iFrame=++this.iFrame,this.uniforms.iTimeDelta=this.iTimeDelta,this.uniforms.mouseX=this.iMouse.x,this.uniforms.mouseY=this.iMouse.y},r.prototype.fragment=function(t,r){var i="mainImage(gl_FragColor,vTextureCoord);",n=t.split("\n"),a=n.find(function(e){return e.indexOf("precision mediump float;")>=0||e.indexOf("precision highp float;")>=0}),o=n.find(function(e){return e.indexOf("void mainImage")>=0});return o?n=n.map(function(e){return e.replace(/fragCoord/g,"fragCoord_")}):console.error("在 chunk 未找到 mainImage 函数,请检查是否为标准shadertoy代码.."),a?n=n.filter(function(e){return e!=a}):a="precision mediump float;",n=n.map(function(e){return e.replace(/texture\(/g,"texture2D(")}),i="void main(){\n    "+i+"\n}",(r?e.__default_shape_frag_src__:e.__default_texture_frag_src__).replace("{precision}",a).replace("{content}",n.join("\n")).replace("{mainentry}",i)},r}(e.ShaderBase);e.ShaderToy=t,__reflect(t.prototype,"vitamin.ShaderToy")}(vitamin||(vitamin={}));var vitamin;!function(e){var t=function(){function t(){}return t.isURL=function(e){var t=e.lastIndexOf(".");if(t>=0){var r=e.substring(t,e.length);return".frag"==r||".vert"==r||".glsl"==r||".chunk"==r}return!1},t.isSrc=function(e){return!this.isURL(e)},t.toColor=function(t){var r=e.ColorUtil.extract(t),i=r[0],n=r[1],a=r[2];return{x:i/255,y:n/255,z:a/255}},t.toColor32=function(t){var r=e.ColorUtil.extract32(t),i=r[0],n=r[1],a=r[2],o=r[3];return{x:n/255,y:a/255,z:o/255,w:i/255}},t.apply=function(t,r,i){return e.TextureUtil.apply(t,r,i)},t}();e.ShaderUtil=t,__reflect(t.prototype,"vitamin.ShaderUtil")}(vitamin||(vitamin={}));var vitamin;!function(e){var t;!function(e){e[e.NORMAL=0]="NORMAL",e[e.ShaderToy=1]="ShaderToy",e[e.PIXIShader=2]="PIXIShader"}(t=e.TypeShader||(e.TypeShader={}));var r=function(r){function i(e){var t=r.call(this)||this;t.container=new egret.DisplayObjectContainer,r.prototype.addChild.call(t,t.container),t.cancas=new egret.Bitmap,r.prototype.addChild.call(t,t.cancas),t.drawRect=e;var i=new egret.RenderTexture;return t.cancas.texture=i,t}return __extends(i,r),i.prototype.shaderOnceByUrl=function(r,i,n){var a;switch(r){case t.PIXIShader:a=new e.ShaderPixi(i);break;case t.ShaderToy:a=new e.ShaderToy(i)}this.shaderOnce(a,n)},i.prototype.shaderOnce=function(t,r){var i=this;if(t)return this.setShader(t,r.uniforms),r.tweens?void this.tweenUniform(r.duration,r.tweens).then(function(e){i.setShader(null)}):void e.timer.once(r.duration,this,function(){i.setShader(null)})},i.prototype.tweenUniform=function(e,t){if(!this.shader)return Promise.resolve();for(var r,i=0,n=t;i<n.length;i++){var a=n[i];r=this.shader.tween(a.uniprop,a.value,e,a.ease)}return r},i.prototype.setShader=function(t,r){if(this.shader!=t){this.shader=t;var i=this.cancas.filters;i||(i=[]),this.shader?(r||(r={debug:!0}),this.shader instanceof e.ShaderPixi&&(r.filterArea={x:this.drawRect.width,y:this.drawRect.height,z:0,w:0}),r&&Object.assign(this.shader.$uniforms,r),i[0]=this.shader,this.cancas.filters=i,this.shaderEnable()):(i.length=0,this.cancas.filters=i,this.shaderDisable())}},i.prototype.getShader=function(){return this.shader},i.prototype.setShaderByUrl=function(r,i,n){var a;switch(r){case t.PIXIShader:a=new e.ShaderPixi(e.Path.basename(i).replace(".frag",""));break;case t.ShaderToy:a=new e.ShaderToy(i)}this.setShader(a,n)},i.prototype.shaderEnable=function(){this.container.visible=!1,this.cancas.visible=!0,this.drawRect?this.rect=this.drawRect:this.rect=new egret.Rectangle(0,0,this.container.width,this.container.height),this.stage.addEventListener(egret.Event.ENTER_FRAME,this.updateRender,this)},i.prototype.shaderDisable=function(){this.container.visible=!0,this.cancas.visible=!1,this.stage.removeEventListener(egret.Event.ENTER_FRAME,this.updateRender,this)},i.prototype.updateRender=function(){this.cancas.texture.drawToTexture(this.container,this.rect,1)},i.prototype.addChild=function(e){return this.container.addChild(e)},i.prototype.addChildAt=function(e,t){return this.container.addChildAt(e,t)},i.prototype.removeChild=function(e){return this.container.removeChild(e)},i.prototype.removeChildAt=function(e){return this.container.removeChildAt(e)},i.prototype.removeChildren=function(){this.container.removeChildren()},Object.defineProperty(i.prototype,"numChildren",{get:function(){return this.container.numChildren},enumerable:!0,configurable:!0}),i}(egret.DisplayObjectContainer);e.ShaderContainer=r,__reflect(r.prototype,"vitamin.ShaderContainer")}(vitamin||(vitamin={}));