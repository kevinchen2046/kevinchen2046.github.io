var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);i.prototype=e.prototype,t.prototype=new i},k25d;!function(t){var e=function(t){function e(e){void 0===e&&(e=0);var i=t.call(this)||this;return i.vanishingPoint=new egret.Point,i._fcous=200,i._backColor=0,i._depthField=1e3,i._rotationX=0,i._rotationY=0,i._rotationZ=0,i._x=0,i._y=0,i._z=0,i._backColor=e,i}return __extends(e,t),e.prototype.setFcous=function(t){this._fcous=t},Object.defineProperty(e.prototype,"fcous",{get:function(){return this._fcous},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthField",{get:function(){return this._depthField},set:function(t){this._depthField=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"backColor",{get:function(){return this._backColor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationZ",{get:function(){return this._rotationZ},set:function(t){this._rotationZ=t,this.move(Math.cos(this._rotationZ)*this.x-Math.sin(this._rotationZ)*this.y,Math.cos(this._rotationZ)*this.y+Math.sin(this._rotationZ)*this.x,this.z),this.updateRotation()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationY",{get:function(){return this._rotationY},set:function(t){this._rotationY=t,this.move(Math.cos(this._rotationY)*this.x-Math.sin(this._rotationY)*this.z,this.y,Math.cos(this._rotationY)*this.z+Math.sin(this._rotationY)*this.x),this.updateRotation()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotationX",{get:function(){return this._rotationX},set:function(t){this._rotationX=t,this.move(this.x,Math.cos(this._rotationX)*this.y-Math.sin(this._rotationX)*this.z,Math.cos(this._rotationX)*this.z+Math.sin(this._rotationX)*this.y),this.updateRotation()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t,this.updatePos(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,this.updatePos()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,this.updatePos()},enumerable:!0,configurable:!0}),e.prototype.move=function(t,e,i){var o=this._z!=i;this._x=t,this._y=e,this._z=i,this.updatePos(o)},e.prototype.updatePos=function(t){void 0===t&&(t=!1),e.posChange.moveupdate=!0,e.posChange.moveupdateZ=t,this.dispatchEventWith(e.POS_CHANGE,!1,e.posChange)},e.prototype.updateRotation=function(){this.dispatchEventWith(e.ROTA_CHANGE)},e.POS_CHANGE="POS_CHANGE",e.ROTA_CHANGE="ROTA_CHANGE",e.posChange={moveupdate:!1,moveupdateZ:!1},e}(vitamin.EventDispatcher);t.Camera=e,__reflect(e.prototype,"k25d.Camera")}(k25d||(k25d={}));var k25d;!function(t){var e=function(e){function i(i,o,n){void 0===i&&(i=0),void 0===o&&(o=0),void 0===n&&(n=0);var r=e.call(this)||this;return o&&n&&r.setSize(o,n),r._container=new egret.DisplayObjectContainer,r.addChild(r._container),r._camera=new t.Camera(i),r._camera.addEventListener(t.Camera.POS_CHANGE,r.onCameraPosChange,r),r._camera.addEventListener(t.Camera.ROTA_CHANGE,r.onCameraRotaChange,r),r._children=[],r.addEventListener(egret.Event.ADDED_TO_STAGE,r.onAddToStage,r),r}return __extends(i,e),i.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.onRemoveFromStage,this),this._width&&this._height||this.setSize(this.stage.stageWidth,this.stage.stageHeight),this._sortInterval=egret.setInterval(this.sort,this,500)},i.prototype.onRemoveFromStage=function(t){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.onAddToStage,this),this._sortInterval&&(egret.clearInterval(this._sortInterval),this._sortInterval=0)},Object.defineProperty(i.prototype,"camera",{get:function(){return this._camera},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"height",{get:function(){return this._height},set:function(t){this._height=t,this._camera.vanishingPoint.y=this._height/2},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width},set:function(t){this._width=t,this._camera.vanishingPoint.x=this._width/2},enumerable:!0,configurable:!0}),i.prototype.setSize=function(t,e){this._width=t,this._height=e,this._container.x=this._width/2,this._container.y=this._height/2},i.prototype.add=function(t){this._children.indexOf(t)<0&&(this._children.push(t),t.add(this._container,this._camera))},i.prototype.remove=function(t){var e=this._children.indexOf(t);e>=0&&(this._children.splice(e,1),t.remove())},Object.defineProperty(i.prototype,"objects",{get:function(){return this._children},enumerable:!0,configurable:!0}),i.prototype.sort=function(){var t;t=this._children.length;for(var e=[],i=0;t--;)this._children[t].parent&&e.push(this._children[t]),i=Math.max(i,this._children[t].scaleX),i=Math.max(i,this._children[t].scaleY);e.sort(function(t,e){return t.z>e.z?-1:1}),t=e.length;for(var o=0;t>o;o++)this._container.setChildIndex(e[o],o)},i.prototype.onCameraPosChange=function(t){},i.prototype.onCameraRotaChange=function(t){this._container.rotation=-this._camera.rotationZ},i}(egret.DisplayObjectContainer);t.Scene=e,__reflect(e.prototype,"k25d.Scene")}(k25d||(k25d={}));var k25d;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t._rotationX=0,t._rotationY=0,t._rotationZ=0,t._x=0,t._y=0,t._z=0,t.onCreate(),t}return __extends(i,e),i.prototype.onCreate=function(){},i.prototype.onShown=function(){},i.prototype.onHide=function(){},i.prototype.onFogChange=function(t,e){},i.prototype.add=function(e,i){this._parent=e,this._parent.addChild(this),this._camera=i,this._camera.addEventListener(t.Camera.POS_CHANGE,this.onCameraPosChange,this),this._camera.addEventListener(t.Camera.ROTA_CHANGE,this.onCameraRotaChange,this),this.updatePos()},i.prototype.remove=function(){this.parent&&this.parent.removeChild(this),this._camera&&(this._camera.removeEventListener(t.Camera.POS_CHANGE,this.onCameraPosChange,this),this._camera.removeEventListener(t.Camera.ROTA_CHANGE,this.onCameraRotaChange,this)),this._camera=null,this._parent=null},Object.defineProperty(i.prototype,"rotationZ",{get:function(){return this._rotationZ},set:function(t){this._rotationZ=t,this.pos(Math.cos(this._rotationZ)*this.x-Math.sin(this._rotationZ)*this.y,Math.cos(this._rotationZ)*this.y+Math.sin(this._rotationZ)*this.x,this.z),this.updateRotation()},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationY",{get:function(){return this._rotationY},set:function(t){this._rotationY=t,this.pos(Math.cos(this._rotationY)*this.x-Math.sin(this._rotationY)*this.z,this.y,Math.cos(this._rotationY)*this.z+Math.sin(this._rotationY)*this.x)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"rotationX",{get:function(){return this._rotationX},set:function(t){this._rotationX=t,this.pos(this.x,Math.cos(this._rotationX)*this.y-Math.sin(this._rotationX)*this.z,Math.cos(this._rotationX)*this.z+Math.sin(this._rotationX)*this.y)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"z",{get:function(){return this._z},set:function(t){this._z=t,egret.callLater(this.updatePos,this),egret.callLater(this.updateFogAmount,this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"y",{get:function(){return this._y},set:function(t){this._y=t,egret.callLater(this.updatePos,this)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"x",{get:function(){return this._x},set:function(t){this._x=t,egret.callLater(this.updatePos,this)},enumerable:!0,configurable:!0}),i.prototype.pos=function(t,e,i){this._x=void 0==t?this._x:t,this._y=void 0==e?this._y:e,this._z=void 0==i?this._z:i,this.updatePos(),this.updateFogAmount()},i.prototype.updatePos=function(){if(null!=this._camera){var t=this._x+this._camera.x,e=this._y+this._camera.y,o=this._z-this._camera.z,n=this._camera.fcous/(this._camera.fcous+o);4>n?(!this.parent&&this._parent&&(this._parent.addChild(this),this.onShown()),0>n&&(n=0),this.scaleX=this.scaleY=n,egret.superSetter(i,this,"x",this._camera.vanishingPoint.x+t*n),egret.superSetter(i,this,"y",this._camera.vanishingPoint.y+e*n)):this.parent&&(this.parent.removeChild(this),this.onHide())}},i.prototype.updateFogAmount=function(){if(this._camera&&this.parent){var t=(this._z-this._camera.z)/this._camera.depthField;t>1&&(t=1),0>t&&(t=0),this.onFogChange(t,this._camera.backColor)}},i.prototype.updateRotation=function(){this._camera&&egret.superSetter(i,this,"rotation",this._rotationZ)},i.prototype.onCameraPosChange=function(t){t.data.moveupdate&&this.updatePos(),t.data.moveupdateZ&&this.updateFogAmount()},i.prototype.onCameraRotaChange=function(t){},i}(egret.Sprite);t.SceneObject=e,__reflect(e.prototype,"k25d.SceneObject")}(k25d||(k25d={}));var k25d;!function(t){var e=function(){function t(){}return t.getScale=function(t,e,i){var o=t-(i?i:0),n=e/(e+o);return n},t.getTransform=function(t,e,i,o,n){var r=0,a=0,s=0;o&&(r=o.x,a=o.y,s=o.z);var h=t.x+r,c=t.y+a,_=t.z-s,u=e/(e+_);return h=i.x+h*u,c=i.y+c*u,n?(n.x=h,n.y=c,n.scale=u,n):{x:h,y:c,scale:u}},t}();t.Util=e,__reflect(e.prototype,"k25d.Util")}(k25d||(k25d={}));